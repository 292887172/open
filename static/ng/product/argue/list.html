
<style>
        html, body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow:auto;
      }

      .addButton{
            padding: 4px 6px;
          background: #ff6202;
          color:#fff;
            font-weight: 500;
            text-decoration:none;
            cursor:pointer;
            border-radius: 4px;
          font-size: 14px;
      }
      .addButton:hover{
          color: #fff;
        text-decoration:none;
        cursor:pointer;
        font-weight: 800;
      }
        .ui-jqgrid tr.jqgrow td{
            position: relative;
            overflow: visible;
            white-space: normal !important;
            height:auto;
            word-break:break-all;
            line-height: 18px;
        }
        .ui-jqgrid-view>.ui-jqgrid-titlebar {
            background: #9EBEE4;
            width: 937px;
            margin-top: 20px;
            z-index: auto;
        }
        .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default{
            z-index: 0;
        }
        input[type=checkbox].ace.ace-switch.ace-switch-5:checked+.lbl::before {
            background-color: #337ab7;
            border-color: #337ab7;
            content: "YES \a0\a0\a0\a0\a0\a0\a0\a0\a0\a0\a0NO"
        }
       .ui-jqgrid .ui-jqgrid-hbox {
            padding-right: 0px;
        }
        .ui-jqgrid-htable ui-common-table
        {
                width: 973px;
                border-left: 1px solid #e1e1e1;
        }
        .headerH1 {
            margin: 8px 8px;
            font-size: 17px;
            line-height: 1.5;
            color: #337AB7;
        }
        .main-container:before {
            position: relative;
        }
        #show-no-data{
            position: relative;
            display: none;
            text-align: center;
            width: 100%;
            padding-bottom: 4%;
            color: #777;
        }
     .help-button{
         background-color: #337ab7;
     }
     .warnCont {
        text-align: left;
    }
        .mt6 {
        margin-top: 27px;
    }
     .popBox h3 {
         background: none;
    }
    .btnBar{
        position: relative;
        background: none;
    }
     .ui-jqgrid .ui-jqgrid-bdiv{
         z-index: 5;
         overflow: visible;
     }
     .prompt-class{
         padding-top: 31px;
     }
    .btn {
        padding: 6px 12px;
    }
     .popover-title{
         border-radius: 5px 5px 0 0;
         background: none;
         border-bottom: none;
     }
     .popover.left {
         margin-left: -27px;
     }
     .popover-content {
        padding: 20px 15px;
    }
     .popover-content button{
         padding: 4px 15px 4px 15px;
     }
     .tips-tbl{
         max-width: none;
     }
     .btn-blue, .btn-blue2{
         background-color: #FF6F37;
     }
    .ui-jqgrid .ui-jqgrid-htable th div{
        text-align: center;
    }
    input[type=checkbox].ace.ace-switch.ace-switch-5+.lbl::before{
        cursor: not-allowed;
    }
    .common_dp-btn{
        display: inline-block;
        height: 36px;
        line-height: 33px;
        color: #666;
        border: 1px solid silver;
        border-radius: 2px;
        font-size: 12px;
        padding: 0 15px 0 15px;
        margin: 5px 7px 5px 0;
        box-sizing: content-box;
    }
    .common_dp-btn:hover{
        border-color: #2fa666;
        cursor: pointer;
    }
    .common_dp-checked{
        color: #2fa666;
        border-color: #2fa666;
        background: #f2f0e1;
    }
    .iconfont:before{
        position: absolute;
        top: -3px;
        display: inline-block;
        content: "\E91A";
    }
    .self-define{
        display: inline-block;
    background-color: #4cd964;
    color: #fff;
    border-radius: 100px;
    padding: 2px 4px;
    margin-left: 2px;
    font-size: 12px;
    }
    .off-btn{
        position: absolute;
        right: 65px;
        bottom: -55px;
        z-index: 1;
    }
    .guanli{
        background-color: #327AB7;
        position: absolute;
        top: 6px;
        right: 36px;
        height: 27px;
        line-height: 20px;
    }
    .add_btn{
        margin-left: 5px;
    }
    .btn.btn-info:hover{
        background-color: #ff6202!important;
        border-color: #ff6202;

    }
    .btn.btn-info{
        background-color: #ff6f37!important;
        border-color: #ff6f37;
        color: #fff !important;
    </style>
    <link rel="stylesheet" href="/static/css/product/jquery-ui-1.8.16.custom.css">
    <div class="main-container box2">
        <div class="hl-help" style="display: none">
            <span class="linkBlue">定义产品功能</span>&nbsp;&nbsp;&nbsp;
            <input type="hidden" id="device_type" ng-value="{[{ app_device_type }]}">
            <span style="margin-left: 300px">已为您定制标准参数，如果标准参数不能满足需求，请通过【+定义新功能】添加。</span>
        </div>

        <div class="mt20" style="display: none"></div>
        <div class="headerH1" style="position: relative;">

             <span style="cursor:pointer;font-size: 16px;margin-left: 5px;color: black">定义控制功能</span>
            <a onclick='export_parameter()' style="cursor:pointer;margin-left: 400px" id='export-protocol' class=''><i class='ace-icon fa fa-arrow-circle-o-down bigger-120'></i><span style="font-size: 16px;margin-left: 5px;">导出控制协议</span></a>
            <a href='http://doc.53iq.com/#/Protocol/README' style='float: right' target='_blank'>53IQ电控通信协议说明</a>
            <div style="float: right;" class="off-btn">
                <select id='selectOpen' onchange='checkToSwitch(this)' style='color: #ff6202;z-index: 1 '>
                    <option value=0>选择总开关</option>
                </select>
                <span class='help-button' style="display: none;" data-rel='popover' data-trigger='hover' data-placement='right' data-content='选择总开关' title='' data-original-title=''>?</span>
            </div>
        </div>
        <table id="grid-table" >
        </table>




        <div style="margin-top: 20px">
            <a class="headerH1" onmouseover="show_tips(this)" style="text-decoration: none;">
             <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom">?</span> 查看产品功能填写规则
        </a>
        </div>


        <div id="tips" style="background: #fff;display: none">

            <h1 class="headerH1">tips</h1>
            <h1 class="headerH1">1.功能序号：主要关系二进制数据中该值所在帧结构中位置<br></h1>
            <h1 class="headerH1">2.长度：是指该功能占用的位数，单位(Bit)。1byte=8Bit<br></h1>
            <h1 class="headerH1">3.单指令帧：设备只需要传输设备功能id(序号)紧接着传该功能的的值，具体传输数据占用长度跟该功能配置长度保持一致<br></h1>
            <h1 class="headerH1">4.全指令帧：设备只需要按功能序号组装数据帧即可，每个功能值占用长度很配置的该功能占用长度保持一致，若传输数据和功能id(序号)对应位置不匹配，会导致功能解析错乱，状态不正确</h1>
         </div>
            <div id="tip2" style="display: none;">
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">单指令：</span>单指令数据部分添加功能序号和对应状态，每次只能传递一个功能状态</p>
                <img src="/static/image/product/prompt1.jpg">
            </div>
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">多指令：</span>多指令增加功能序号和对应状态，可以交替传递多个，可交替，可多，可少</p>
                <img src="/static/image/product/prompt2.jpg">
            </div>
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">全指令：</span>全指令数据部分传输的功能状态必须和功能列表顺序保持一致，不可交叉，不可漏传</p>
                <img src="/static/image/product/prompt3.jpg">
                <img style="    position: relative;margin-left: 75%;" src="/static/image/product/tishi.png">
            </div>
        </div>
        <div id="ie-form"></div>
    </div>



    <div class="main-container ace-save-state box2" id="main-container" style="display: none">
    <div class="hl-help">

    <span class="linkBlue">添加新功能</span>
    <span class="linkBlue" style="float: right;cursor: pointer" onclick="func2()">返回</span>
        <input id="device_type" type="hidden" value="{[{ app_device_type}]}">
        <input id="ididid" type="hidden" value="">


    </div>
<div class="mt20"></div>
    <div class="main-content">
        <div class="main-content-inner">

            <div class="page-content" style="padding-top:20px">


                <h1 class="headerH1">参数信息</h1>
                <div class="space-6"></div>
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <form method="post" class="form-horizontal" role="form">
                             <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="name" style="text-align:right"> <span class="must-choose">*</span>功能名称 <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="在自动生成的设备模拟器和Demo App界面中显示的数据点名称，进行自定义应用开发时可以修改。" title="">?</span></label>
                                <div class="col-sm-9 col-xs-9">
                                    <input ng-disabled='{[{ disabled }]}' type="text" id="name"  placeholder="标识符的中文名称，显示在产品详情界面" class="col-xs-10 col-sm-5" onblur="checkName()"/>
                                    <br><br><div id="checkName" style="color:red;margin-top:15px;display:none"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="Stream_ID" style="text-align:right"> <span class="must-choose">*</span>功能标识符 <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="数据点及其参数传输时的变量名，支持英文字母、数字和下划线，以英文字母开头。" title="">?</span></label>
                                <div class="col-sm-9 col-xs-9">
                                    <input type="text" id="Stream_ID"  placeholder="由大小写字母、数字或下划线组成，以字母开头且不能重复" class="col-xs-10 col-sm-5" onblur="checkID()"/>
                                    <br><br><div id="checkID" style="color:red;margin-top:15px;display:none;"></div>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="mxsLength" style="text-align:right"> <span class="must-choose">*</span>长度(单位bits) <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="数据域和结果码的长度，单位是bit，例如（开关：1bit）" title="">?</span></label>
                                <div class="col-sm-9 col-xs-9">
                                    <input ng-disabled='{[{ disabled }]}' type="text"  id="mxsLength"  placeholder="数据域和结果码的长度，如：8（bits）" class="col-xs-10 col-sm-5" onblur="checkLength()"/>
                                    <br><br><div id="checkLength" style="color:red;margin-top:15px;display:none"></div>
                                </div>
                            </div>
                                <div class="form-group">
                                    <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="corpName" style="text-align:right"> 单位名称 </label>
                                    <div class="col-sm-9 col-xs-9">
                                        <input ng-disabled='{[{ disabled }]}' type="text" id="corpName" placeholder="请输入参数的单位名称，如：摄氏度" class="col-xs-10 col-sm-5" />
                                    </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="corpMark" style="text-align:right"> 单位符号 </label>
                                <div class="col-sm-9 col-xs-9">
                                    <input ng-disabled='{[{ disabled }]}' type="text" id="corpMark" placeholder="请输入参数的单位名称，如：℃" class="col-xs-10 col-sm-5"/>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="paramType" style="text-align:right"><span class="must-choose">*</span>功能点类型 <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="开关型(bool): 非真即假的二进制变量，如开关功能; 故障型: 专门用户统计和上报故障的功能点; 定时类型: 可选择型调节时间范围，如工作时间; 枚举型: 自定义的有限集合值，如档位的高、中、低。" title="">?</span> </label>
                                <div class="col-sm-9 col-xs-9" id="param-type">
                                        <div class="radio">
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="paramType" type="radio" class="ace input-lg" onclick="selectBool(this)" value="1" checked/>
                                                    <span class="lbl bigger-120"> 开关</span>
                                                </label>
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="paramType" type="radio" class="ace input-lg" onclick="selectError(this)" value="3"/>
                                                    <span class="lbl bigger-120"> 故障型</span>
                                                </label>

                                                <label>
                                                        <input ng-disabled='{[{ disabled }]}' name="paramType" type="radio" class="ace input-lg" onclick="selectInt(this)" value="4"/>
                                                        <span class="lbl bigger-120"> 整型</span>
                                                    </label>
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="paramType" type="radio" class="ace input-lg" onclick="selectTimer(this)" value="5"/>
                                                    <span class="lbl bigger-120"> 定时型</span>
                                                </label>
                                        </div>
                                        <div id="selectBool" style="background-color:#fff;display:block;margin-left:10px;margin-top:5px;border:1px solid #ccc;width:180px;padding:5px 10px">
                                            <table border=0>
                                                <tr>
                                                    <td height=30px align="center">最小值</td>
                                                    <td align="center">最大值</td>
                                                </tr>
                                                <tr style="border-top:1px solid #ccc">
                                                    <td width=80px>
                                                        <input ng-disabled='true' id="minBool" ng-value="0" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc">
                                                    </td>
                                                    <td width=80px align="right">
                                                        <input ng-disabled='true' id="maxBool" ng-value="1" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc">
                                                    </td>
                                                </tr>
                                            </table>
                                            <div id="checkBool" style="margin-left:-10px;color:red;display:none;left: 228px;top: 77px;position:absolute"></div>
                                        </div>
                                        <div id="selectError" style="background-color:#fff;display:none;margin-left:95px;margin-top:5px;border:1px solid #ccc;width:180px;padding:5px 10px">
                                            <span style="position:relative;top: 10px;left: -70px;">故障值：</span>
                                            <input ng-disabled='{[{ disabled }]}' id="errorValue" type="text" style="border:none;width:100%;text-align:center;">
                                            <div id="checkError" style="margin-left:-10px;color:red;display:none;left: 228px;top: 77px;position:absolute"></div>
                                        </div>
                                        <div id="selectInt" style="background-color:#fff;display:none;margin-left:160px;margin-top:5px;border:1px solid #ccc;width:180px;padding:5px 10px">
                                            <table border=0>
                                                <tr>
                                                    <td height=30px align="center">最小值</td>
                                                    <td align="center">最大值</td>
                                                </tr>
                                                <tr style="border-top:1px solid #ccc">
                                                    <td width=80px>
                                                        <input ng-disabled='{[{ disabled }]}' id="minInt" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc" value=0 onblur="checkInt()">
                                                    </td>
                                                    <td width=80px align="right">
                                                        <input ng-disabled='{[{ disabled }]}' id="maxInt" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc" value=1 onblur="checkInt()">
                                                    </td>
                                                </tr>
                                            </table>
                                            <div id="checkInt" style="margin-left:-10px;color:red;display:none;left: 228px;top: 77px;position:absolute"></div>
                                        </div>
                                        <div id="selectTimer" style="background-color:#fff;display:none;margin-left:290px;margin-top:5px;border:1px solid #ccc;width:180px;padding:5px 10px;">
                                            <table border=0>
                                                <tr>
                                                    <td height=30px align="center">最小值</td>
                                                    <td align="center">最大值</td>
                                                </tr>
                                                <tr style="border-top:1px solid #ccc">
                                                    <td width=80px>
                                                        <input ng-disabled='{[{ disabled }]}' id="minTimer" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc" onblur="checkTimer()">
                                                    </td>
                                                    <td width=80px align="right">
                                                        <input ng-disabled='{[{ disabled }]}' id="maxTimer" type="text" style="border:none;width:76px;text-align:center;border-bottom:1px solid #ccc" onblur="checkTimer()">
                                                    </td>
                                                </tr>
                                            </table>
                                            <div id="checkTimer" style="margin-left:-10px;color:red;display:none;left: 513px;top: 77px;position:absolute"></div>
                                        </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="isControl" style="text-align:right"> 可控 <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="可控”表示您的参数可以被控制，如：“开关”；“不可控”表示您的参数不可被控制，如：“PM2.5”；" title="">?</span> </label>
                                <div class="col-sm-9 col-xs-9">
                                        <div class="radio">
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="isControl" onclick="showFun()" type="radio" class="ace input-lg" value="1" checked/>
                                                    <span class="lbl bigger-120"> 可控</span>
                                                </label>
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="isControl" onclick="hideFun()" type="radio" class="ace input-lg" value="0"/>
                                                    <span class="lbl bigger-120"> 不可控</span>
                                                </label>
                                        </div>
                                </div>
                            </div>
                            <div class="form-group" id="fun_attr">
                                <label class="col-sm-3 col-xs-3 control-label no-padding-right" for="isFunction" style="text-align:right"> 功能属性 <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content="功能按钮”表示该参数可以直接上报，如：“开关”；“属性按钮”表示该参数的一个特性不可直接上报，如：“温度”；" title="">?</span> </label>
                                <div class="col-sm-9 col-xs-9">
                                        <div class="radio">
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="isFunction" type="radio" class="ace input-lg" value="1" checked/>
                                                    <span class="lbl bigger-120"> 功能</span>
                                                </label>
                                                <label>
                                                    <input ng-disabled='{[{ disabled }]}' name="isFunction" type="radio" class="ace input-lg" value="0"/>
                                                    <span class="lbl bigger-120"> 属性</span>
                                                </label>
                                        </div>
                                </div>
                            </div>
                        </form><!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
                </div><!-- /.row -->

                <div class="page-header"></div>
                <h1 class="headerH1">参数值<span class="help-button" data-rel="popover" data-trigger="hover" data-placement="bottom" data-content=" 硬件与53iq智能云通信的数据及说明，例：传送数据:0 数据说明:关、传送数据:1 数据说明:开" title="">?</span></h1>
                <div class="space-6"></div>

                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <form class="form-horizontal" role="form">
                            <div class="page-header" style="padding-top: 20px; padding-left: 54px;" >
                                <span>标准参数</span>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 col-xs-2 no-padding-right">  </label>
                                <label class="col-sm-1 col-xs-2 no-padding-right"> 传送数据 </label>&nbsp;&nbsp;&nbsp;
                                <label class="col-sm-2 col-xs-3 no-padding-right" style="margin-left: 77px"> 数据说明 </label>
                                <div id="checkArgue" style="color:red;display:none"></div>
                            </div>
                            <div class="form-group" id="addGroup"></div>
                            <div class="page-header" style="padding-top: 20px;padding-left: 54px;" >
                                <span>自定义参数</span> <a  style="padding-left: 36px;color: #337ab7;background: white" ng-hide='{[{ visible }]}' href='#' onclick='add();return false' class='addButton'>
                                        <i class='ace-icon glyphicon glyphicon-plus'></i> 添加</a>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 col-xs-2 no-padding-right">  </label>
                                <label class="col-sm-1 col-xs-2 no-padding-right"> 传送数据 </label>&nbsp;&nbsp;&nbsp;
                                <label class="col-sm-2 col-xs-3 no-padding-right" style="margin-left: 77px"> 数据说明 </label>
                                <div id="checkArgue1" style="color:red;display:none"></div>
                            </div>
                            <div class="form-group" id="addGroup1"></div>
                            <div class="clearfix form-actions" style="margin-bottom:-15px;background-color: #fff">
                                <div class="col-sm-2 col-xs-2"></div>

                                <div class="col-sm-5 col-xs-6">
                                    <span class="pr20">
                                        <button  ng-hide='{[{ visible }]}' class="btn btn-info" type="button"  ng-click="Save(id)" style="width: 100px">
                                        <i  class="ace-icon fa fa-check bigger-110" style="padding-left: 0px"></i><span id="save-content">保存</span>
                                        </button>
                                    </span>
                                    <span>
                                        <a ng-hide='{[{ visible }]}' class="btn" id="rem" type="button" style="width: 100px">
                                        <i  class="ace-icon fa fa-undo bigger-110" style="padding-left: 0px"></i>返回</a>
                                    </span>
                                </div>
                            </div>
                        </form><!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
                </div><!-- /.row -->


            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->
</div>
<div style="display: none"><input type="text" id="vid"></div>
    <!-- page specific plugin scripts -->
    <script src="/static/assets/js/jquery.jqGrid.min.js"></script>
    <script src="/static/assets/js/grid.locale-en.js"></script>
    <script src="/static/common/js/jquery.sortable.js"></script>
    <script src="/static/common/js/jquery-ui-1.10.3.custom.min.js"></script>

    <!-- inline scripts related to this page -->
    <script type="text/javascript">


        function setCookie(name, value) {
            var Days = 30;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
            document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString()+";path=/";
        }
        //读取cookies
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

            if (arr = document.cookie.match(reg))

                return unescape(arr[2]);
            else
                return null;
        }
        function show_tips(obj) {
            if($("#tips").css("display") == "none"){
                $("#tips").css("display","block");
                $("#tip2").css("display","block");
            }
            else {
                $("#tips").css("display","none");
                $("#tip2").css("display","none");
            }
        }
        function manageMod() {
             $.ajax({
                url:location.href,
                type:"POST",
                data:{'name':'show_mod'},
                async :false,
                success: function (data) {
                    mods = data.data;
                    msg = '';
                    for(var k=0; k<mods.length; k++){
                        msg += '<div class="common_dp-btn" data-id="'+mods[k].Stream_ID+'"><i class="fa fa-check"></i><span>'+mods[k].name+'</span></div>'
                    }
                    if(msg == ''){
                        msg = "当前无可选标准功能点，<a href='#/edit' ng-hide='{[{ visible }]}' class='addButton'><i  class='ace-icon glyphicon glyphicon-plus'></i><span class='add_btn' onclick='func5()'>添加</span>"
                    }
                    bootbox.dialog({
                        message: msg,
                        title:"新增标准功能",
                        buttons:{
                            "success" :
                             {
                                "label" : "<i class='icon-ok'></i> 确定",
                                "className" : "btn btn-primary",
                                "callback": function() {
                                    checked_mod=$(".common_dp-checked");
                                    add_mod = [];
                                    for(var index =0;index<checked_mod.length;index++){
                                        var $container = $(checked_mod[index]);
                                        var S_id  = $container.attr("data-id");
                                        add_mod.push(S_id);
                                    }
                                    if (add_mod.length!=0){
                                        add_mod = JSON.stringify(add_mod);
                                        SendPostData({'name':'add_mod',"funs":add_mod},"添加标准功能")
                                        location.reload()
                                    }
                                }
                            },
                            "cancel": {
                                "label" : "<i class='icon-info'></i> 取消",
                                "className" : "btn btn-default"
                                }
                        }
                    });
                    $(".bootbox-body div").click(function () {
                        if ($(this).hasClass("common_dp-checked")){
                            $(this).removeClass("common_dp-checked");
                        }
                        else {
                            $(this).addClass("common_dp-checked");
                        }
                    });
                    $(".modal-body").css("height","auto");
                    $(".modal-dialog").css("width","600px");
                },
                error:function (data) {
                    console.log("失败");
                }
             });
        }
        //select_table("grid-table",{"name": "list"},"<span>产品功能</span>&nbsp;&nbsp;&nbsp;<a onclick='manageMod()' class='addButton guanli'>管理</a> <a href='#/edit' ng-hide='{[{ visible }]}' class='addButton'><i  class='ace-icon glyphicon glyphicon-plus'></i><span class='add_btn'>添加</span></a> <a href='http://doc.53iq.com/#/Protocol/READMEx' target='_blank'>53IQ电控通信协议说明</a>","gridpager");

        select_table("grid-table",{"name": "list"},"<a onclick='manageMod()' class='addButton guanli'>管理</a> <a href='#/edit' ng-hide='{[{ visible }]}' class='addButton'><i  class='ace-icon glyphicon glyphicon-plus'></i><span class='add_btn'>添加</span> ","gridpager");
        //select_table("grid-table-new",{"name": "list","is_standa":'1'},"<span>自定义功能</span> &nbsp;&nbsp;&nbsp;<a href='#/edit' ng-hide='{[{ visible }]}' class='addButton'><i  class='ace-icon glyphicon glyphicon-plus'></i>添加</a>","gridpager-new");
        function select_table(table,data,name,page) {
            jQuery("#"+table).jqGrid({
                url: location.href,
                postData: data,
                datatype: "json",
                mtype: "POST",
                colNames: ['序号', '功能标识', '长度', '功能名称', '参数个数', '手机App可控', '云菜谱可控', '操作'],
                colModel: [
                    {name: 'id', width: 107, align: 'center'},
                    {name: 'Stream_ID', align: 'center', width: 143, formatter: function (cellvalue, options,rowObject) {
                        if(rowObject.standa_or_define=='1'){
                            return cellvalue+"<span class='self-define'>自定义</span>"
                        }
                        else{
                            return cellvalue
                        }


                        }},
                    {name: 'mxsLength', width: 100, align: 'center'},
                    {name: 'name', width: 127, align: 'center'},
                    {name: 'mxsNum', width: 120, align: 'center', title: false,
                        formatter: function (cellvalue, options, rowObject) {
                            if($("#selectOpen option[value="+rowObject.id+"]").text() == ''){
                                msg = "<option value=" + rowObject.id + ">" + rowObject.Stream_ID + "</option>";
                                $("#selectOpen").append(msg);
                            }
                            if (rowObject.toSwitch == 1) {
                                $("#selectOpen").val(rowObject.id);
                            }
                            if (cellvalue == "" || cellvalue == "0") {
                                return '<a href="#/argue" class="btn btn-white btn-xs" style="width:60px" >暂无</a>';
                            }
                            else {
                                group = '<a class="btn btn-white btn-xs" style="width:60px" onmouseover="show_table(this)" onmouseout="hide_table(this)">' + cellvalue + '</a>';
                                group += '<div style="display: none"><table class="tips-tbl" cellspacing="0" cellpadding="0" style="height:100px;z-index:9999;float: left;width: 200px;' +
                                    'background: white;position: absolute;top: 45px;  border: 2px solid rgb(199, 211, 169);box-shadow:rgb(199, 211, 169) 2px 4px 6px;">'

                                group += '<thead ><tr style="height: 30px"><th >传送数据 </th><th >数据说明</th></tr></thead><tbody style="word-break: break-all;">'
                                trans_data = rowObject.mxs;
                                for (var i = 0; i < trans_data.length; i++) {
                                    group += '<tr><td >' + trans_data[i].data + '</td><td >' + trans_data[i].desc + '</td></tr>'
                                }
                                group += '</tbody></table></div>';
                                return group;
                            }
                        }
                    },
                    {name: 'isControl', width: 108, align: 'center',
                        formatter: function (cellvalue) {
                            if (cellvalue == "1") {
                                return "<input name='toControl' onclick='toControl(this)' type='checkbox' class='ace ace-switch ace-switch-5' checked/><span class='lbl middle'></span>";

                            } else {
                                return "<input name='toControl' onclick='toControl(this)' type='checkbox' class='ace ace-switch ace-switch-5'/><span class='lbl middle'></span>";
                            }
                        }
                    },

                    {name: 'isCloudMenu', width: 108, align: 'center',
                        formatter: function (cellvalue) {
                            if (cellvalue == "1") {
                                return '<input name="isCloud" onclick="checkToCloud(this)" type="checkbox"  class="ace ace-switch ace-switch-5" checked/><span  class="lbl middle"></span>';

                            } else {
                                return '<input name="isCloud"  onclick="checkToCloud(this)" type="checkbox"  class="ace ace-switch ace-switch-5"/><span  class="lbl middle"></span>';
                            }
                        }
                    },
                    {name: 'operation', width: 150, align: 'center',
                        formatter: function (cellvalue, options, rowObject) {
                            return "<span style='color:#337ab7;cursor:pointer'  onclick=func(" + rowObject.id + ") >编辑</span> | <a rel='popover' href='#/argue' id='del-info" + rowObject.id + "' onclick='del(this)' class='del-info' style='color:#337ab7'>删除</a>";
                        }
                    }
                ],
                rowNum:20,
                rowList : [ 10, 20, 30 ],
                altRows: true,
                viewrecords : true,
                pager:"#"+page,
                multiselect: false,
                multiboxonly: true,
                caption: name,
                gridComplete: function () {
                    $("#"+table).jqGrid('setGridWidth', $(".rightMain").width() - 33);
                    $("#"+table).jqGrid('setGridHeight', 'auto');
                    $(window).resize(function () {
                        $("#"+table).jqGrid('setGridWidth', $(".rightMain").width() - 33);
                        $("#"+table).jqGrid('setGridHeight', 'auto');
                    });
                },
                loadComplete: function (rows) {
                    $('[data-rel=popover]').popover({container: 'body'});
                    document.getElementById(table).style.width = '938px';
                    tt = document.getElementsByClassName('ui-jqgrid-htable ui-common-table')[0];
                    tt.style = 'border-left:1px solid #e1e1e1;width:940px;border-right:1px solid #e1e1e1;';

                    if (rows.rows.length == 0) {
                        $("#"+page).css("display","none");
                        if(table=="grid-table-new"){
                            $("#show-no-data").css('display', 'block');
                            $("#advice-content").text("标准功能无法满足，可添加产品功能");
                        }
                    }
                    if (rows.check_state >= 1) {
                        document.getElementById("selectOpen").setAttribute('disabled', 'true');
                        SetDisable();
                    }
                    else {
                        if (table == "grid-table"){
                                $("#"+table).children('tbody').sortable({
                                update: function (event, ui) {
                                    var item = ui.item;
                                    bootbox.confirm("确定交换两者位置?", function (result) {
                                        if (result)
                                            update_id(item);
                                        else
                                            $("#"+table).children('tbody').sortable('cancel');
                                    })
                                }
                            });
                        }
                    }
                }
            });
        }
        function SetDisable() {
            $("input[type=checkbox].ace.ace-switch+.lbl").css({'cursor': 'not-allowed'});
            $("input[type=checkbox].ace.ace-switch").css({'pointer-events':'none'});
            $("td a").parent().css({'cursor': 'not-allowed'});
            $("td a").css({'pointer-events':'none'});
        }
        function SendPostData(data, types) {
            $.ajax({
                url:location.href,
                type:"POST",
                data:data,
                async :false,
                success: function (data) {
                        console.log(types, "更新成功")
                        location.reload()
                    },
                error:function (data) {
                    console.log(types, "更新失败");
                }
            });
        }
        function checkToSwitch(ths) {
            id = $(ths).val();
            post_data = {'name':'toSwitch','id':id};
            SendPostData(post_data, '设置产品总开关');
        }
        function toControl(ths) {
            aa = $(ths).prop('checked');
            id = $(ths).parent().parent().attr("id");
            if(aa==false){dd=0;}
            else{dd=1;}
            post_data = {'name':'isControl','id':id,'dd':dd};
            SendPostData(post_data, '设置是否可控');
        }
        function checkToShow(ths) {
            num=0;
            id = $(ths).parent().parent().attr("id");
            var advice = "本产品最多设置3个卡片显示值";
            shows = document.getElementsByName("isShow");
            for(var i=0;i< shows.length;i++){
                if(shows[i].checked == true && id != i+1){
                    num +=1;
                }
                if (num>=3){
                    $(ths).attr('checked',false);
                    bootbox.alert(advice);
                    return;
                }
            }
            aa = $(ths).prop('checked');
            if(aa==false){dd=0;}
            else{dd=1;}
            post_data = {'name':'isShow','id':id,'dd':dd};
            SendPostData(post_data, '设置卡片显示值');
        }
        function checkToDisplay(ths) {
            id = $(ths).parent().parent().attr("id");
            aa = $(ths).prop('checked');
            if(aa==false){dd=0;}
            else{dd=1;}
            post_data = {'name':'isDisplay','id':id,'dd':dd};
            SendPostData(post_data, '设置是否显示在UI上');
        }
        function checkToCloud(ths) {
            id = $(ths).parent().parent().attr("id");
            aa = $(ths).prop('checked');
            if(aa==false){dd=0;}
            else{dd=1;}
            post_data = {'name':'isCloudMenu','id':id,'dd':dd};
            SendPostData(post_data, '设置云菜谱是否可控');
        }
        function show_table(item) {
            $(item).nextAll('div').show();
            $(item).nextAll('div').children('table').show()
        }
        function hide_table(item) {
            $(item).nextAll('div').hide();
            $(item).nextAll('div').children('table').hide()
        }
        function export_parameter(){
            var rows = $("#grid-table").getRowData();
            var rows1 = $("#grid-table-new").getRowData();
            if(rows == '' && rows1 == ''){
                bootbox.alert("暂无参数信息！");
                return;
            }
            bootbox.confirm("确定导出控制协议参数吗?", function (result) {
                if (result) {
                    var form = document.createElement('form');
                    form.action = '#/argue';
                    form.method = 'post';
                    form.style = "display: none";
                    var input = document.createElement("input");
                    input.name = "name";
                    input.type = "text";
                    input.value = "export";
                    form.appendChild(input);
                    $("#ie-form").html(form);
                    form.submit();
                }
            });
        }
        $('body').click(function (event) {
            var target = $(event.target);
            if (!target.hasClass('popover')
                    && !target.hasClass('popover-content')
                    && !target.hasClass('popover-title')
                    && !target.hasClass('arrow')
                    && !target.hasClass('del-info')
                    &&!target.hasClass('text-info')) {
                $('.del-info').popover('hide');
            }
        });
        function del(ths){
            // 选择是否删除产品功能
            id = $(ths).parent().parent().attr("id");
            $(ths).popover({
                trigger:'manual',
                placement: 'left',
                html: 'true',
                title : '<span class="text-info">确定要删除该功能点吗 ？</span>',
                content : '<button onclick="fun_close()">取消</button> <button onclick="delete_fun(\''+id +'\')" style="background-color: #337AB7;border-color: #337AB7;margin-left: 20px;color: #fff;">确认</button>'
              });
            $('.del-info').popover('hide');
            $(ths).popover('toggle');
        }
        function delete_fun(id) {
            post_data = {'name': 'del', 'id': id};
            $("#del-info" + id).popover('destroy');
            SendPostData(post_data,"删除功能");
            // 删除产品的某一功能后，该功能的后续的功能对应id和位置向前移动一位

            RePosition(id,1);
            if(isIE()){
                document.getElementById(id).removeNode(true);
            }
            else{
                document.getElementById(id).remove();
            }
        }
        function update_id(item) {
            id = item.attr("id");
            fun_name = [];
            // 重新按位置排序，并更新这一行中所有用到id的位置
            fun_name = RePosition(0,0);

            fun_name = JSON.stringify(fun_name);
            SendPostData({'name':'update','funs':fun_name}, '更新功能顺序');
        }
        function RePosition(id,index,rows) {
            if(id<101){
                rows = document.getElementById("grid-table").rows;
                flag = false;
            }
            else{
                rows = document.getElementById("grid-table-new").rows;
                flag = true;
            }
            fun_name = [];
            length = rows.length;
            for (var i = 1; i <length; i++) {
                if (parseInt(id) < rows[i].id) {
                    if(! flag){
                        k = i -index;
                    }
                    else{
                        k = rows[i].id - index;
                    }
                    rows[i].children[0].innerText = k;
                    rows[i].id = k;
                    d_id = "del-info" + k;

                    last = rows[i].children[rows[i].children.length - 1];
                    last.firstChild.href = "#/edit?id=" + k;

                    last.lastChild.id = d_id;
                    fun_name.push(rows[i].children[1].title);
                }
            }
            return fun_name;
        }
        function fun_close() {
        // 关闭删除弹窗
            $('.del-info').popover('hide');
        }
        //
        $("#rem").click(function () {

            document.getElementsByClassName("main-container")[1].style.display='none'
            document.getElementsByClassName("main-container")[0].style.display=''
        })
        function func5() {
          document.getElementsByClassName("btn-primary")[0].click()
        }
        function func4() {
            document.getElementsByClassName("main-container")[0].style.display='none'
             document.getElementsByClassName("main-container")[1].style.display=''
        }
        function func2() {
             document.getElementsByClassName("main-container")[1].style.display='none'
             document.getElementsByClassName("main-container")[0].style.display=''
        }
        function func(that) {
            var num = location.href.split("#")[0].split("=")[1]
            document.getElementById("vid").value=that

            document.getElementById('ididid').value=that
            console.log(num)
            document.getElementsByClassName("main-container")[0].style.display='none'
            document.getElementsByClassName("main-container")[1].style.display=''
            $.ajax({
                url:'?ID=' + num + '#/edit?id=' + that,
                type:"POST",
                data:{'name':'edit','id':that},
                async:false,
            }).success(function (data11) {
                edit_data=data11['data'];
                funs = data11['funs'];
                mods = data11['mods'];
                if(!edit_data){
                    flag = true;
                }
                else{flag = false;}
                init()
                })
        }
        var url=location.href;
        var num=url.indexOf('?id');
        var str=url.substring(num+1);
        var id = str.split("=")[1];
        var count=0;
        var mxs = [];
        var trig=[];
        var dataVal = 0;
        var Text='';
        function init() {
        count++;
        if(flag == false){
            var obj={
                id:id,
                Stream_ID:edit_data["Stream_ID"],
                name:edit_data["name"],
                isControl:edit_data["isControl"],
                isFunction:edit_data["isFunction"],
                min:edit_data["min"],max:edit_data["max"],
                errorData:edit_data["errorData"],
                paramType:edit_data["paramType"],
                corpName:edit_data["corpName"],
                corpMark:edit_data["corpMark"],
                mxs:edit_data["mxs"],
                mxsLength:edit_data["mxsLength"],
                time:edit_data["time"]};
                loadData(obj);
                mxs=obj.mxs;
        }
        else{
            $(".form-horizontal")[0].reset();
            $(".form-horizontal")[1].reset();
            $('#mxsLength').val('8');
        }
    }

    function showFun() {
        $("#fun_attr").css('display','block')
    }
    function hideFun() {
        $("#fun_attr").css('display','none')
    }
    function loadData(d){

        $('#Stream_ID').val(d.Stream_ID);
        $('#name').val(d.name);
        $('#corpName').val(d.corpName);
        $('#corpMark').val(d.corpMark);
        $('#mxsLength').val(d.mxsLength);
        if (edit_data.standa_or_define != 1){
            $("#Stream_ID").attr("disabled",true);
        }
        if(d.isControl==1){
            document.getElementsByName('isControl')[0].checked=true;
            showFun();
        }else{
            document.getElementsByName('isControl')[1].checked=true;
            hideFun();
        }
        if(d.isFunction==1){
            document.getElementsByName('isFunction')[0].checked=true;
        }else{
            document.getElementsByName('isFunction')[1].checked=true;
        }

        if(d.paramType==1){
            document.getElementsByName('paramType')[0].checked=true;

            selectBool();
        }else if(d.paramType==3){
            document.getElementsByName('paramType')[1].checked=true;
            $('#errorValue').val(d.errorData);
            $('#minInt').val(d.min);
            $('#maxInt').val(d.max);
            selectError();
        }
        else if(d.paramType==4){
            $('#minInt').val(d.min);
            $('#maxInt').val(d.max);
            document.getElementsByName('paramType')[2].checked=true;
            selectInt();
        }
        else if(d.paramType==5){
            document.getElementsByName('paramType')[3].checked=true;
            $('#minTimer').val(d.min);
            $('#maxTimer').val(d.max);
            selectTimer();
        }
        if(count<=1) {
            for (var i = 0; i < d.mxs.length; i++) {
                var group = '';
                flag = false;
                if(edit_data["Stream_ID"]=="MODEL" && $("#device_type").val()==11 && d.mxs[i].data<=100) {
                    flag = true;
                }
                group += '<div class="form-group">';
                group += '	<div class="col-sm-2 col-xs-2"></div>';
                group += '	<div class="col-sm-2 col-xs-3">';
                group += '		<input ng-disabled="'+flag + '" onblur="check_paramData(this)" type="text" name="paramData" placeholder="" class="col-xs-12 col-sm-12" value="' + d.mxs[i].data + '"/>';
                group += '	</div>';
                group += '	<div class="col-sm-2 col-xs-2">';
                group += '		<input ng-disabled="{[{ disabled }]}" onblur="check_paramDesc(this)" type="text" name="paramDesc" placeholder="" class="col-xs-12 col-sm-12" value="' + d.mxs[i].desc + '"/>';
                group += '	</div>';
                group += '	<div class="col-sm-3 col-xs-2" style="padding-top:6px">';
                group += '		<a ng-hide="{[{ visible }]}" href="#" onclick="del1(this);return false" class="addButton" style="color: #337ab7;background: white"><i class="fa fa-times-circle bigger-150"></i></a>';
                group += '      <a ng-hide="{[{ visible }]}" style="display: none;padding-left: 30px;color: #337ab7;background: white" onclick="select_trigger(this)" class="addButton" >触发器管理</a>';
                group += '	</div>';
                if(d.mxs[i].advice!='' && d.mxs[i].advice!=undefined) {
                    group += '<div class="advice col-sm-4 col-xs-4" style="padding-top: 19px;color:#ff6202;display:none"> *' + d.mxs[i].advice + '</div>';
                }
                group += '</div>';
                if(edit_data.standa_or_define) {
                    $("#addGroup1").before(group);
                }
                else{
                    $("#addGroup").before(group);
                }
            }
        }
        else{$(".form-horizontal")[1].reset();}
    }
    function selectInt(){
        SetDisplay("selectInt");
    }
    function selectError(){
        SetDisplay("selectError");
    }
    function selectBool(){
        $("#mxsLength").val(1);
        SetDisplay("selectBool")
    }
    function selectTimer(){
        SetDisplay("selectTimer")
    }
    function SetDisplay(name) {
        $('#selectInt').css("display","none");
        $('#selectBool').css("display","none");
        $('#selectTimer').css("display","none");
        $('#selectError').css("display","none");
        $("#"+name).css("display","block");
    }
    //获取元素的纵坐标
    function getTop(e){
        var offset=e.offsetTop;
        if(e.offsetParent!=null) offset+=getTop(e.offsetParent);
        return offset;
    }
    //获取元素的横坐标
    function getLeft(e){
        var offset=e.offsetLeft;
        if(e.offsetParent!=null) offset+=getLeft(e.offsetParent);
        return offset;
    }
    function add(){
        flag = true;
        var group='';
        group+='<div class="form-group">';
        group+='	<div class="col-sm-2 col-xs-2"></div>';
        group+='	<div class="col-sm-2 col-xs-3">';
        group+='		<input type="text" id="checkData" onblur="check_paramData(this)" onkeypress="return onKeyPress(event)" name="paramData1" placeholder="" class="col-xs-12 col-sm-12"/>';
        group+='	</div>';
        group+='	<div class="col-sm-2 col-xs-3">';
        group+='		<input type="text" name="paramDesc1" onkeypress="return onKeyPress(event)" placeholder="" class="col-xs-12 col-sm-12"/>';
        group+='	</div>';
        group+='	<div class="col-sm-3 col-xs-2" style="padding-top:6px">';
        group+='		<a href="#" onclick="del1(this);return false" class="addButton" style="color: #337ab7;background: white"><i class="fa fa-times-circle bigger-150"></i></a>';
        group += '      <a ng-hide="{[{ visible }]}" style="display: none;padding-left: 30px;color: #337ab7;background: white" onclick="select_trigger(this)" class="addButton">触发器管理</a>';
        group+='	</div>';
        group+='</div>';
        $("#addGroup1").before(group);
        $('[data-rel=popover]').popover({container:'body'});

        mxs.push({"data":'',"desc":''})
    }
    function del1(ths){
        value = $(ths.parentNode.parentNode.children[1].children).val();
        for(var i=0;i<mxs.length;i++) {
            if(mxs[i].data==value) {
                mxs.splice(i,1);
                break;
            }
        }
        if(isIE()){
            $(ths.parentNode.parentNode).removeNode(true);
        }
        else{
            $(ths.parentNode.parentNode).remove();
        }
    }
    function onKeyPress(event) {
        if(event.keyCode==13){
            add();
        }
    }
    function check_paramData(ths) {
        value = $(ths).val();

        if(value==''|| value==null){
            $('#checkArgue1').html("请填写数据说明和传送数据");
            $('#checkArgue1').css("display","block");
        }
        else if(edit_data["Stream_ID"]=="MODEL" && $("#device_type").val()==11 && value<=100){
            $('#checkArgue1').html("请保持自定义参数值大于100");
            $('#checkArgue1').css("display","block");
        }
        else{
            $('#checkArgue1').css("display","none");
        }
    }
    function check_paramDesc(ths) {
        $(".advice").css("display","none");
        p = $(ths).parent().parent().children(".advice").css("display",'block');
    }
    function select_trigger(ths) {
        value = $(ths.parentNode.parentNode.children[1].children).val();
        name = $(ths.parentNode.parentNode.children[2].children).val();
        if(value==""||name==""){
            $('#checkArgue1').css("display","block");
            $('#checkArgue1').html("请填写数据说明和传送数据");
            return;
        }
        $('#checkArgue1').css("display","none");
        var funcs=[];
        var data;
        var bool = false;
        var table = '<div class="table"><table class="prod-setting-table">\
            <thead class="thead">\
            <tr>\
                <th class="td-1">功能名称</th>\
                 <th class="td-5">最小值</th>\
                 <th class="td-6">最大值\
                </th>\
                <th class="td-7">默认值</th>\
                \<th class="td-7">操作</th>\
            </tr>\
            </thead>\
           <tbody class="tbody" id="addFunc">';
        trig = [];
        for (var j = 0; j < mxs.length; j++) {
            if (mxs[j].data == value) {
                dataVal = j;
                data = mxs[j];
                bool = true;
                if (data.trigger && data.trigger[0] != null) {
                    temp = data.trigger;
                    for (var k = 0; k < temp.length; k++) {
                        table += '<tr>';
                        table += '<th>' + temp[k].name + '</th>';
                        table += '<th>' + temp[k].min + '</th>';
                        table += '<th>' + temp[k].max + '</th>';
                        table += '<th>' + temp[k].val + '</th>';
                        table += '<th><a onclick="delFunc(this,\'' + temp[k].name + '\')">移除</a></th>';
                        table += '</tr>';
                        funcs.push(temp[k].name);
                        trig.push(temp[k])
                    }
                }
                break;
            }
        }
        if(bool==false){    //新增加group
            dataVal = mxs.length-1;
            mxs[dataVal].data = value;
            mxs[dataVal].desc = name;
        }

        table += '</tbody></table></div>';
        var msg = '<div class="row" style="text-align:left"><div class="col-xs-4"><span>功能: </span><select id="selectFunc" style="width:120px" onchange="SelectFunc(this)">';
        msg += "<option value=0>选择功能</option>";
        for(var i=0; i<funs.length;i++){
            if(funs[i].Stream_ID != edit_data.Stream_ID && funcs && $.inArray(funs[i].name, funcs)==-1)
                msg += "<option value="+funs[i].Stream_ID+">"+funs[i].name+"</option>"
        }
        msg += '</select></div>';
        msg += '<div class="col-xs-4"><span class="float-left" >参数值范围: </span><input style="width:50px" step="1" id="minDefault" class="form-control float-left" value="0">';
        msg += '<span class="float-left"> - </span><input style="width:50px" id="maxDefault" step="1" class="form-control float-left" autocomplete="off" value="50"></div>';
        msg += '<div class="col-xs-4"><span class="float-left" >默认值: </span><input id="defaultVal" style="width:50px" step="1" placeholder="" class="form-control float-left">';
        msg += '<button type="button" class="btn btn-success" onclick=addToList()>添加</button></div></div>';
        bootbox.dialog({
            title:"添加触发器",
            message:msg+table,
            buttons:{
                "success": {
                    "label": "<i class='icon-info'></i> 确定",
                    "className": "btn-primary",
                    "callback":function () {
                        if(mxs!=null){
                            mxs[dataVal].trigger=trig;
                        }
                    }
                },
                "cancel" : {
                    "label": "<i class='icon-ok'></i> 取消",
                    "className": "btn-default"
                }
            }
        })
    }
    function addToList() {
        var ofRow={};
        msg = '<tr>';
        name = $("#selectFunc").find("option:selected").text();
        func = $("#selectFunc").val();
        min = $("#minDefault").val();
        max = $("#maxDefault").val();
        val = $("#defaultVal").val();
        if(func && func!=0) {
            msg += '<th>' + name + '</th>';
            msg += '<th>' + min + '</th>';
            msg += '<th>' + max + '</th>';
            msg += '<th>' + val + '</th>';
            msg += '<th><a onclick="delFunc(this,\''+name+'\')">移除' + '</a></th>';
            $("#addFunc").append(msg);
            ofRow['name']=name;
            ofRow['min']=min;
            ofRow['max']=max;
            ofRow['val']=val;
            ofRow["func"]= func;
            trig.push((ofRow));
            $("#selectFunc option[value=" + func + "]").remove();
        }
    }

    function delFunc(ths,name) {
        opt = "<option value="+name+">"+name+"</option>";
        $(ths.parentNode.parentNode).remove();
        for(var i=0;i<trig.length;i++) {
            if(trig[i].func==name){
                trig.splice(i,1);
            }
        }
        $("#selectFunc").append(opt);
    }

    function SelectFunc(ths) {
        var name = $(ths).val();
        for(var i=0;i<funs.length;i++){
            if(funs[i].Stream_ID==name){
                $("#minDefault").val(funs[i].min);
                $("#maxDefault").val(funs[i].max);
                if(funs[i].mxs[0]!=null){
                    $("#defaultVal").val(funs[i].mxs[0].data);
                }
                else{
                    $("#defaultVal").val('')
                }
            }
        }
    }
    function getTrigger(data) {
        for(var i=0 ; i<mxs.length; i++)
        {
            if(mxs[i].data==data){
                var trigger = mxs[i].trigger;
                return trigger;
            }
        }
        return [];
    }
    function checkID(){
        var role=/^[a-zA-Z][a-zA-Z0-9_]*$/;
        var data=$.trim($('#Stream_ID').val());
        var temp =false;

        if(edit_data &&edit_data.standa_or_define != 1 && edit_data.Stream_ID!=data){
            $('#checkID').html("该参数不可修改");
            $('#checkID').css("display", "block");
            return "error";
        }
        if (data == '' || role.test(data) == false) {
            $('#checkID').html("该参数以英文字母、数字下划线组成、不能重复");
            $('#checkID').css("display", "block");
            return "error";
        }
        else if(mods.indexOf(data)>-1){
            $('#checkID').html("该功能参数已经存在！");
            $('#checkID').css("display", "block");
            return "repeat"
        }
        else {
            $('#checkID').css("display", "none");
            return "correct";
        }
    }
    function checkName(){
        if($.trim($('#name').val())==''){
            $('#checkName').html("功能名称不能为空!!");
            $('#checkName').css("display","block");
            return false
        }else{
            $('#checkName').css("display","none");
            return true
        }
    }
    function checkLength(){
        if($.trim($('#mxsLength').val())==''){
            $('#checkLength').html("长度不能为空!!");
            $('#checkLength').css("display","block");
            return false
        }
        else{
            $('#checkLength').css("display","none");
            length = parseInt($("#mxsLength").val());
            maxValue = Math.pow(2,length)-1;
            $("#minInt").val(0);
            $("#maxInt").val(maxValue);
            return true
        }
    }
    function checkInt(){
        var min=$.trim($('#minInt').val());
        var max=$.trim($('#maxInt').val());
        var length = $.trim($('#mxsLength').val());
        maxValue = Math.pow(2,length)-1;
        //正整数 + 0
        var role1=/^\d+$/;
        //负整数 + 0
        var role2=/^((-\d+)|(0+))$/;
        if((role1.test(min)==false && role2.test(min)==false) || (role1.test(max)==false && role2.test(max)==false)){
            $('#checkInt').html("请填写整数!!");
            $('#checkInt').css("display","block");
            return "请填写整数!!";
        }else if(parseInt(min) >= parseInt(max)){
            $('#checkInt').html("最大值必须大于最小值!!");
            $('#checkInt').css("display","block");
            return "最大值必须大于最小值!!";
        }
        else if(parseInt(max)>maxValue){
            $('#checkInt').html("最大值必须小于默认极大值!!");
            $('#checkInt').css("display","block");
            return "最大值大于极大值";
        }
        else{
            $('#checkInt').css("display","none");
            return "";
        }
    }
    function checkTimer() {
        var min=$.trim($('#minTimer').val());
        var max=$.trim($('#maxTimer').val());
        //正整数 + 0
        var role1=/^\d+$/;
        //负整数 + 0
        var role2=/^((-\d+)|(0+))$/;
        if((role1.test(min)==false && role2.test(min)==false) || (role1.test(max)==false && role2.test(max)==false)){
            $('#checkTimer').html("请填写时间！");
            $('#checkTimer').css("display","block");
            return "请填写时间!!";
        }else if(parseInt(min) >= parseInt(max)){
            $('#checkTimer').html("最大值必须大于最小值!!");
            $('#checkTimer').css("display","block");
            return "最大值必须大于最小值!!";
        }else{
            $('#checkTimer').css("display","none");
            return "";
        }
    }
    function checkBool() {
        var length= $('#mxsLength').val();
        if (length!=1){
            $("#checkBool").html("开关型的长度只能为1");
            $("#checkBool").css("display","block");
            return "开关型长度只能为1";
        }
        else{
            $("#checkBool").css("display","none");
            return "";
        }
    }
    function checkEnum() {
        var enum_value=$.trim($('#maxEnum').val());
        enum_value = enum_value.split(' ');
        if(enum_value.length<2)
        {
            $('#checkEnum').html("枚举值之间必须用空格隔开");
            $('#checkEnum').css("display","block");
        }else{
            $('#checkEnum').css("display","none");
            return "";
        }
    }
    </script>