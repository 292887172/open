 <style>
        html, body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow:auto;
      }
      .addButton{
            padding: 4px;
          background: #327AB7;
          color:#fff;
            font-weight: 500;
            text-decoration:none;
            cursor:pointer;
            border-radius: 4px;
      }
      .addButton:hover{
          color: #fff;
        text-decoration:none;
        cursor:pointer;
        font-weight: 800;
      }
        .ui-jqgrid tr.jqgrow td{
            overflow: visible;
            position: relative;
        }
        .ui-jqgrid-view>.ui-jqgrid-titlebar {
            background: #9EBEE4;
            width: 937px;
            margin-top: 20px;
            z-index: auto;
        }
        input[type=checkbox].ace.ace-switch.ace-switch-5:checked+.lbl::before {
            background-color: #337ab7;
            border-color: #337ab7;
        }
       .ui-jqgrid .ui-jqgrid-hbox {
            padding-right: 0px;
        }
        .ui-jqgrid-htable ui-common-table
        {
                width: 973px;
                border-left: 1px solid #e1e1e1;
        }
        .headerH1 {

            margin: 8px 8px;
            font-size: 17px;
            line-height: 1.5;
            color: #337AB7;

        }
        .main-container:before {
            position: relative;
        }
        #show-no-data{
            position: relative;
            width: 200px;
            height: 200px;
            left: 42%;
            top: 40px;"
        }
     .help-button{
         background-color: #337ab7;
     }

     .warnCont {
        text-align: left;
    }
        .mt6 {
        margin-top: 27px;
    }
     .popBox h3 {
         background: none;
    }
    .btnBar{
        position: relative;
        background: none;
    }
     .ui-jqgrid .ui-jqgrid-bdiv{
         z-index: 0;
         overflow: visible;
     }
     .prompt-class{
         padding-top: 31px;
     }
    .modal-content {
        border-radius: 6px;
    }
    .modal-footer {
        padding: 19px 20px 20px;
        margin-top: 15px;
        text-align: right;
        border-top: 1px solid #e5e5e5;
        background-color: #FFFFFF;
        border-radius: 6px;
    }
    .modal-body {
        padding: 20px;
    }
    .btn {
        display: inline-block;
        padding: 6px 12px;
        margin-bottom: 0;
        font-size: 14px;
        font-weight: normal;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 6px;
    }
    .btn-default, .btn-default.focus, .btn-default:focus {
        color: #333 !important;
        background-color: #dddddd !important;
    }
    .btn-default:hover{
        color: #333 !important;
        background-color: #c6c6c6 !important;
    }
    .btn-primary, .btn-primary.focus, .btn-primary:focus {
        color: #fff !important;
        background-color: #ff6f37 !important;
    }
    .btn.btn-primary:hover{
        color: #fff !important;
        background-color: #ff6202 !important;
        border-color: #ff6202 !important;
    }
    .bootbox-body{
        color: #788188;
        line-height: 1.4;
    }
     .popover-title{
         border-radius: 5px 5px 0 0;
         background: none;
         border-bottom: none;
     }
     .popover.left {
         margin-left: -27px;
     }
         .popover-content {
        padding: 20px 15px;
    }
     .popover-content button{
             padding: 4px 15px 4px 15px;
     }
    .modal{
            text-align: center;
    }
    .modal:before {
        display: inline-block;
        vertical-align: middle;
        content: " ";
        height: 100%;
    }
     .modal-dialog {
        display: inline-block;
        text-align: left;
        vertical-align: middle;
    }
     .btn-blue, .btn-blue2{
         background-color: #FF6F37;
     }
    </style>
    <div class="main-container box2">
        <div class="hl-help">
            <span class="linkBlue">定义产品功能</span>
    </div>
        <div class="mt20"></div>
        <table id="grid-table" >
        </table>
        <h1 class="headerH1"><span class="help-button" onclick="show_tips(this)" data-rel="popover" data-trigger="hover" data-placement="bottom">?</span> 查看产品功能填写规则</h1>
        <div id="tips" style="background: #fff;display: none">

            <h1 class="headerH1">tips</h1>
            <h1 class="headerH1">1.功能序号，主要关系二进制 数据中改值所在帧结构中位置<br></h1>
            <h1 class="headerH1">2.长度是指该功能占用的位数，单位(Bit)。1byte=8Bit<br></h1>
            <h1 class="headerH1">3.若是单功能帧，设备只需要传输设备功能id(序号)紧接着传该功能的的值，具体传输数据占用长度跟该功能实际占用长度保持一致<br></h1>
            <h1 class="headerH1">4.全功能帧，设备只需要按功能序号组装数据帧即可，每个功能值占用长度很配置的该功能占用长度保持一致，若传输数据和功能id(序号)对应位置不匹配，导致功能解析错乱，状态不正确</h1>
         </div>
        <div id="tip2" style="display: none;">
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">单指令：</span>单指令数据部分添加功能序号和对应状态，每次只能传递一个功能状态</p>
                <img src="/static/image/product/prompt1.jpg">
            </div>
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">多指令：</span>多指令增加功能序号和对应状态，可以交替传递多个，可交替，可多，可少</p>
                <img src="/static/image/product/prompt2.jpg">
            </div>
            <div class="prompt-class">
                <p class="headerH1" style="font-weight: bold;"><span style="font-size: 24px;">全指令：</span>全指令数据部分传输的功能状态必须和功能列表顺序保持一致，不可交叉，不接漏传</p>
                <img src="/static/image/product/prompt3.jpg">
                <img style="    position: relative;margin-left: 75%;" src="/static/image/product/tishi.png">
            </div>
        </div>
        <div id="show-no-data"></div>
        <div id="grid-pager"></div>
        <div id="ie-form"></div>
    </div>

    <div class="popBox" id="newHtmlBox" style="display: block;z-index: 111111;">
        <a href="javascript:;" onclick="new_close()" class="close">关闭</a>
        <h3 style="text-align: center">温馨提示</h3>
        <div class="cont mt20" style="margin-top: 20px;">
            <div class="warnCont">
                <p class="mt6">我们已经根据您的产品品类，为您推荐了标准参数，如果标准参数不能满足</p>
                <p class="mt6">您的需求，您可以申请自定义参数，但需要审核通过后才能发布</p>
            </div>
        </div>
        <p align="center"><input type="checkbox" id="check_continueShowTips" >不再提示</p>

        <span style="    padding-left: 40%;">
            <a  href="" onclick="new_close()"  class="btn-blue">知道了</a>
        </span>

    </div>

    <!-- page specific plugin scripts -->
    <script src="/static/assets/js/jquery.jqGrid.min.js"></script>
    <script src="/static/assets/js/grid.locale-en.js"></script>
    <script src="/static/js/ejs.js"></script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">
                var streamID={};
                var flag = getCookie('cookie_prompt');
                if(flag){
                    $("#newHtmlBox").css('display','none');
                    $(".markLayout").hide();
                }
                else{
                    $(".markLayout").show();
                }
                function new_close() {
                    var check_prompt = $("#check_continueShowTips").is(':checked');
                    // 关闭的情况下，选中不再提醒
                    if (check_prompt){
                        setCookie('cookie_prompt', check_prompt);
                    }
                    $("#newHtmlBox").css('display','none');
                    $(".markLayout").hide();
                }
                function setCookie(name, value) {
                    var Days = 30;
                    var exp = new Date();
                    exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
                    document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString()+";path=/";
                }
                //读取cookies
                function getCookie(name) {
                    var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

                    if (arr = document.cookie.match(reg))

                        return unescape(arr[2]);
                    else
                        return null;
                }
                function show_tips(obj) {
                    if($("#tips").css("display") == "none"){
                        $("#tips").css("display","block");
                        $("#tip2").css("display","block");
                    }
                    else {
                        $("#tips").css("display","none");
                        $("#tip2").css("display","none");
                    }
                }
            jQuery(function($) {
				jQuery("#grid-table").jqGrid({
					url:"#/argue",
					postData:{"name": "list"},
					datatype: "json",
					mtype:"POST",
					colNames:['功能序号','功能标识', '长度', '功能名称','参数个数','是否可控', '是否启用','操作'],
					colModel:[
						{name:'id' , width:107,align:'center'},

						{name:'Stream_ID', width:143},
                        {name:'mxsLength',width:100,align:'center'},
						{name:'name', width:127,align:'center'},
						{name:'mxsNum', width:120,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="" || cellvalue=="0"){
										return '<a href="#/argue" class="btn btn-white btn-xs" style="width:60px" >暂无</a>';
									}else{
                                        var id="canshu"+rowObject.id;
                                        group = new EJS({url: '/static/js/tmpl/table.ejs'}).render({"id":id, "cellvalue":cellvalue,"mxs":rowObject.mxs});
                                        return group;
									}
							}
						},
						{name:'isControl', width:108,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="1"){
										return '是';
									}else{
										return '否';
									}
							}
						},
						{name:'state', width:131,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="1"){

										return '<input id="state-temp'+rowObject.id+'" onclick="state(\''+rowObject.id+'\')" type="checkbox" class="ace ace-switch ace-switch-5" checked/><span ng-disabled="true" class="lbl middle"></span>';

									}else{
										return '<input id="state-temp'+rowObject.id+'"  onclick="state(\''+rowObject.id+'\')" type="checkbox" class="ace ace-switch ace-switch-5"/><span ng-disabled="true" class="lbl middle"></span>';
									}
							}
						},
						{name:'operation', width:150,align:'center',
							formatter:function(cellvalue, options, rowObject){
                            return "<a id='edit-info"+rowObject.id+"' style='color:#337ab7'  href='#/edit?id="+rowObject.id+"' >编辑</a> | <a rel='popover' href='#/argue' id='del-info"+rowObject.id+"' onclick='del(\""+rowObject.id+"\")' class='del-info' style='color:#337ab7'>删除</a>";
						}
						}
					],
					//height:600,
					viewrecords : true,
					altRows: true,
					multiselect: false,
	        multiboxonly: true,
            caption: "<a onclick='add()' ng-hide='{[{ visible }]}' class='addButton'><i  class='ace-icon glyphicon glyphicon-plus'></i>定义产品功能</a>&nbsp;&nbsp;&nbsp;&nbsp;<a onclick='export_parameter()'  class='addButton'><i class='ace-icon fa fa-arrow-circle-o-down bigger-120'></i>导出控制协议</a>",

            gridComplete:function(){
					    $("[data-toggle='popover']").popover();
                    $('.ui-jqgrid-sortable').eq(0).attr("align","center");
                    //$('.ui-jqgrid-sortable').eq(2).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(3).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(4).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(5).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(6).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(7).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(8).attr("align","center");
	        		$("#grid-table").jqGrid( 'setGridWidth', $(".rightMain").width()-33 );

	        		$("#grid-table").jqGrid( 'setGridHeight', 'auto' );
	        		$(window).resize(function() {
							$("#grid-table").jqGrid( 'setGridWidth', $(".rightMain").width()-33 );
                            $("#grid-table").jqGrid( 'setGridHeight', 'auto' );

							});
	        },
            loadComplete:function (rows) {
                $("[data-toggle='popover']").popover();
                row = rows.rows;
                if(row.length==0){
                    $("#grid-table").jqGrid( 'setGridHeight', 'auto');
                    $("#show-no-data").text("您还未添加任何产品功能");
                }
                for ( var i=0;i<row.length ;i++){
                    id = row[i].id;
                    streamID[id]=row[i].Stream_ID;

                    temp=document.getElementById("canshu"+id);
                    $(temp).parents('td').removeAttr('title');
                    if (rows.check_state >= 1) {
                    document.getElementById("state-temp"+id).setAttribute('disabled','true');
                    document.getElementById("edit-info"+id).removeAttribute('href');
                    document.getElementById("del-info"+id).removeAttribute('onclick');
                    document.getElementById("del-info"+id).removeAttribute('href');
                }
                }
                document.getElementById('grid-table').style.width='938px';
                tt = document.getElementsByClassName('ui-jqgrid-htable ui-common-table')[0];
                tt.style = 'border-left:1px solid #e1e1e1;width:940px;border-right:1px solid #e1e1e1;';
            }
				});
				//$("#loadingDiv").hide();
			});
            function show_table(item) {
                $(item).nextAll('div').show();
                $(item).nextAll('div').children('table').show()
            }
            function hide_table(item) {
                $(item).nextAll('div').hide();
                $(item).nextAll('div').children('table').hide()
            }
			function state(id) {
			    post_data = {'name':'state','id':id};
			    $.ajax({
                   url:"#/argue",
                    type:"POST",
                    data:post_data,
                    async :false,
                    success: function (data) {
                       if(data=='change_success'){
                       }
                        },
                    error:function (data) {
                        console.log("启用失败");
                    }
                });
            }
            function add(){
                location.href = "#/edit";
			}
			function export_parameter(){
                var rows = $("#grid-table").getRowData();
                if(rows == ''){
                    bootbox.alert("暂无参数信息！");
                    return;
                }
                bootbox.confirm("确定导出控制协议参数吗?", function (result) {
                    if (result) {
                        var form = document.createElement('form');
                        form.action = '#/argue';
                        form.method = 'post';
                        form.style = "display: none";
                        var input = document.createElement("input");
                        input.name = "name";
                        input.type = "text";
                        input.value = "export";
                        form.appendChild(input);
                        $("#ie-form").html(form);
                        form.submit();
                    }
                });
			}
			function edit(id){
                //把id传给前台
				location.href="#/edit?id="+id;
			}
            $('body').click(function (event) {
                var target = $(event.target);
                if (!target.hasClass('popover')
                        && !target.hasClass('popover-content')
                        && !target.hasClass('popover-title')
                        && !target.hasClass('arrow')
                        && !target.hasClass('del-info')
                        &&!target.hasClass('text-info')) {
                    $('.del-info').popover('hide');
                }
            });
			function del(id){
                // 选择是否删除产品功能
			    $("#del-info"+id).popover({
                    trigger:'manual',
                    placement: 'left',
                    html: 'true',
                    title : '<span class="text-info">确定要删除该功能点吗 ？</span>',
                    content : '<button onclick="fun_close()">取消</button> <button onclick="delete_fun(\''+id +'\')" style="background-color: #337AB7;border-color: #337AB7;margin-left: 20px;color: #fff;">确认</button>'
                  });
                $('.del-info').popover('hide');
                $("#del-info"+id).popover('toggle');
			}
			function delete_fun(id) {
                // 确认删除产品功能
                post_data = {'name': 'del', 'id': id};
                $("#del-info" + id).popover('destroy');
                document.getElementById(id).remove();

                // 删除产品的某一功能后，该功能的后续的功能对应id和位置向前移动一位
                rows = document.getElementById("grid-table").rows.length;
                for (var i = 1; i <=rows; i++) {
                    if (parseInt(id) < i){
                        $("#"+i).children()[0].innerText = i-1;
                        $("#"+i).attr('id',i-1);
                        a = "del(" + (i-1) + ")";
                        b = "del-info" + (i-1);
                        $("#del-info"+i).attr("onclick",a);
                        $("#del-info"+i).attr('id', b)
                    }
                }
                // 异步请求后台删除数据
                $.ajax({
                    url:"#/argue",
                    type: "POST",
                    data: post_data,
                    success: function (data) {
                        console.log("删除成功");
                        bootbox.alert("该功能已删除")
                    },
                    error:function () {
                        console.log("删除失败")
                    }
                });
            }
                function fun_close() {
			    // 关闭删除弹窗
                    $('.del-info').popover('hide');
                }
		</script>