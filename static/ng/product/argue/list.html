
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="description" content="Dynamic tables and grids using jqGrid plugin" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <div class="main-container">

        <table id="grid-table" ></table>
        <div id="grid-pager"></div>
        <div id="ie-form"></div>
    </div>
    <!-- page specific plugin scripts -->
    <script src="/static/assets/js/jquery.jqGrid.min.js"></script>
    <script src="/static/assets/js/grid.locale-en.js"></script>
    <script src="/static/js/ejs.js"></script>
    <script src="/static/js/product/bootbox.js"></script>
    <style>
        html, body {
        width: 100%;
        height: 100%;
        padding: 0px;
        margin: 0px;
        overflow:auto;
      }
      .addButton{
        color:#fff;
        text-decoration:none;
        cursor:pointer;
      }
      .addButton:hover{
        color:#fff;
        text-decoration:none;
        cursor:pointer;
      }
        .ui-jqgrid tr.jqgrow td{
            overflow: visible;
            position: relative;
        }
        .ui-jqgrid-view>.ui-jqgrid-titlebar {
            background: #37618F
        }
        input[type=checkbox].ace.ace-switch.ace-switch-4:checked+.lbl::before, input[type=checkbox].ace.ace-switch.ace-switch-5:checked+.lbl::before {
            background-color: #37618F;
            border-color: #37618F;
        }
    </style>
		<!-- inline scripts related to this page -->
		<script type="text/javascript">
			jQuery(function($) {
				jQuery("#grid-table").jqGrid({
					url:"#/argue",
					postData:{"name": "list"},
					datatype: "json",
					mtype:"POST",

					colNames:['id','mxs','Stream_ID', '长度', '参数名称','参数个数','是否可控', '是否启用','操作'],
					colModel:[
						{name:'id' , width:80,align:'center'},
                        {name:'mxs',hidden:true},
						{name:'Stream_ID', width:100, title:"234"},
                        {name:'mxsLength',width:80,align:'center'},
						{name:'name', width:80,align:'center'},
						{name:'mxsNum', width:80,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="" || cellvalue=="0"){
										return '<a href="#/argue" class="btn btn-white btn-xs" style="width:60px" >暂无</a>';
									}else{
                                        var id="canshu"+rowObject.id;
                                        group = new EJS({url: '/static/js/tmpl/table.ejs'}).render({"id":id, "cellvalue":cellvalue,"mxs":rowObject.mxs});
                                        return group;
									}
							}
						},
						{name:'isControl', width:80,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="1"){
										return '是';
									}else{
										return '否';
									}
							}
						},
						{name:'state', width:80,align:'center',
							formatter:function(cellvalue, options, rowObject){
									if(cellvalue=="1"){

										return '<input id="" onclick="state(\''+rowObject.id+'\')" type="checkbox" class="ace ace-switch ace-switch-5" checked/><span class="lbl middle"></span>';

									}else{
										return '<input id="" onclick="state(\''+rowObject.id+'\')" type="checkbox" class="ace ace-switch ace-switch-5"/><span class="lbl middle"></span>';
									}
							}
						},
						{name:'operation', width:80,align:'center',
							formatter:function(cellvalue, options, rowObject){
									return '<a style="color:#37618F" href="#/edit?id='+rowObject.id+'" >编辑</a>| <a style="color:#37618F" href="#/argue" onclick="del(\''+rowObject.id+'\')">删除</a>';
							}
						}
					],
					//height:600,
					viewrecords : true,
					//rowNum:10,
					//rowList:[10,20,30],
					//pager : "#grid-pager",
					altRows: false,
					multiselect: false,
	        multiboxonly: true,
            caption: "<a onclick='add()' class='addButton'><i class='ace-icon glyphicon glyphicon-plus'></i>添加参数</a>&nbsp;&nbsp;&nbsp;&nbsp;<a onclick='export_parameter()' class='addButton'><i class='ace-icon fa fa-arrow-circle-o-down bigger-120'></i>导出参数表</a>",

            gridComplete:function(){
                    $('.ui-jqgrid-sortable').eq(0).attr("align","center");
                    //$('.ui-jqgrid-sortable').eq(2).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(3).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(4).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(5).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(6).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(7).attr("align","center");
	        	 	$('.ui-jqgrid-sortable').eq(8).attr("align","center");
	        		$("#grid-table").jqGrid( 'setGridWidth', $(".rightMain").width() );
	        		$("#grid-table").jqGrid( 'setGridHeight', $("body").height() );

	        		$(window).resize(function() {
							  $("#grid-table").jqGrid( 'setGridWidth', $(".rightMain").width() );
				        $("#grid-table").jqGrid( 'setGridHeight', $("body").height() );
							});

	        }
				});
			});

            function show_table(item) {

                $(item).parent('td').removeAttr('title');
                $(item).nextAll('div').show();
                $(item).nextAll('div').children('table').show()
            }
            function hide_table(item) {
                $(item).nextAll('div').hide();
                $(item).nextAll('div').children('table').hide()
            }
			function state(id) {
			    post_data={'name':'state','id':id};
			    $.ajax({
                   url:"#/argue",
                    type:"POST",
                    data:post_data,
                    async :false,
                    success: function () {
                            alert("修改成功");
                        }
                });
            }
            function add(){
                location.href="#/edit";
			}
			function export_parameter(){
                var rows=$("#grid-table").getRowData();
                bootbox.confirm("确定导出" + rows.length + "台设备的数据吗?", function (result) {
                    if (result) {
                        var form = document.createElement('form');
                        form.action = '#/argue';
                        form.method = 'post';
                        form.style="display: none";
                        var input = document.createElement("input");
                        input.name = "name";
                        input.type = "text";
                        input.value = "export";
                        form.appendChild(input);
                        $("#ie-form").html(form);
                        form.submit();
                    }
                })
			}
			function edit(id){
                //把id传给前台
				location.href="#/edit?id="+id;
			}
			function del(id){
			     post_data={'name':'del','id':id};
                 $.ajax({
                        url:"#/argue",
                        type: "POST",
                        data: post_data,
                        //async :false,
                        success: function (data) {
                            location.reload();
                            alert("删除成功");
                        },
                        error:function () {
                            alert("删除失败")
                        }
                    });
			}
		</script>