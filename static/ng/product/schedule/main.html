<!--进度表-->
<link href="/static/bootstrap/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
<style>
    dt {
        padding: 10px;
        width: 286px;

        overflow: hidden;
    }

    .plan {
        margin: 7px 14px;
        text-align: center;
        border: 1px solid #ccc;
    }

    .plan:hover {
        border: #2fa666 1px solid;
    }

    .card {
        margin-left: 10px;
        float: left;
        position: relative;
    }

    img {
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    a {
        cursor: default;
    }

    a:hover {
        text-decoration: none;
    }

    #user_address .modal-header {
        background: #dfe6eb;
    }

    #user_address .modal-footer {
        border-radius: 0;
    }

    #user_address .modal-content {
        width: 500px;
    }

    #user_address .modal-body {
        height: 165px;
        text-align: center;
    }

    #user_address .modal-body p {
        font: 16px/45px "microsoft yahei";
    }

    #user_address .modal-body p span {
        margin-left: 5px;
    }

    #user_address .modal-body p input {
        text-indent: 10px;
        border-radius: 3px;
        border: 1px solid #d9d9d9;
        width: 350px;
        line-height: 32px;
    }

    .file {
        position: relative;
        display: inline-block;
        background: #D0EEFF;
        border: 1px solid #99D3F5;
        border-radius: 4px;
        padding: 4px 12px;
        overflow: hidden;
        color: #1E88C7;
        text-decoration: none;
        text-indent: 0;
        line-height: 20px;
    }

    .file input {
        position: absolute;
        font-size: 100px;
        right: 0;
        top: 0;
        opacity: 0;
    }
    .xxx{
        width: 170px;
        position: relative;
        display: inline-block;
        background: #D0EEFF;
        border: 1px solid #99D3F5;
        border-radius: 4px;
        padding: 4px 12px;
        overflow: hidden;
        color: #1E88C7;
        text-decoration: none;
        text-indent: 0;
        line-height: 20px;
    }
    .file:hover {
        background: #AADFFD;
        border-color: #78C3F3;
        color: #004974;
        text-decoration: none;
    }
    .disaplaied{
        pointer-events:none;
    }
    .xxxx{
        background-color: #cacaca!important;
    }
    button{
        border-right: 0px !important;
        border-left: 0px!important;
        border-bottom: 0px!important;
        border-top: 0px!important;
    }
</style>

<div class="title-sub" style="text-align: center;font-size: larger">
    项目计划书

</div>
<div class="modal fade" id="user_address" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    上传文件
                </h4>
            </div>
            <div class="modal-body">


                <input class="file" id="file" name="file" style="display: inline-block" type="file"/>
                <button id="doUpload" class="btn btn-info" onclick="doUploadFile()"
                        style="float: right;width:80px;height:30px;padding-bottom: 0px;padding-top: 0px">
                    上传
                </button>
                <div>
                     <span style="float: left;margin-top: 40px;margin-left: 50px" >备注信息：</span><input type="text" id="ui_info" class="xxx" style="display: inline-block;margin-top:25px;margin-left:-80px " placeholder="备注信息">
                </div>


            </div>


        </div>
    </div>
</div>
<table class="table table-bordered">
    <thead>
    <tr>
        <th>序号</th>
        <th>任务</th>
        <th>时间</th>
        <th>操作</th>
        <th>确认(不可更改)</th>
    </tr>
    </thead>
    <tbody>
    <tr >
        <th scope="row">1</th>
        <td>提交详细技术功能规划书</td>
        <td ><input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-1"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(1)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>

        </td>
        <td><button type="button" class="btn btn-danger"  onclick="confirm(1)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">2</th>
        <td>提交电控板功能协议文档</td>
        <td><input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-2"/></td>
        <td>
            <button id="xx" type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(2)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger"  onclick="confirm(2)">确认</button></td>

    </tr>
    <tr>
        <th scope="row">3</th>
        <td>提交正式UI和UE</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-3"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(3)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(3)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">4</th>
        <td>制定项目进度计划书</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-4"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(4)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(4)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">5</th>
        <td>应用程序开发</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-5"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(5)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(5)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">6</th>
        <td>提供正式电控版</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-6"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(6)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger"  onclick="confirm(6)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">7</th>
        <td>控制协议对接</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-7"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(7)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(7)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">8</th>
        <td>提供整机</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-8"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(8)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(8)">确认</button></td>
    </tr>
    <tr>
        <th scope="row">9</th>
        <td>整机联调、老化测试</td>
        <td>
            <input type="text" placeholder="请选择日期" class="form-control pull-right"
                                       id="reservation-9"/>
        </td>
        <td>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_address"
                    onclick="xxx(9)">上传
            </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="" style="display:inline-block;cursor: pointer;color: black" download="UI"></a>
        </td>
        <td><button type="button" class="btn btn-danger" onclick="confirm(9)">确认</button></td>
    </tr>
    </tbody>
</table>
<div style="display: none">
    <input type="text" value="" id="get_value">
    <input type="text" value="" id="get_remarks">
    <input type="text" value="" id="get_time_stemp">
</div>



<script>
    $('.pull-right').daterangepicker();
    $.ajax({
        url: '/product/schedule',
        type: "GET",
        data: {"key": keysss}
    }).success(function (data) {
        data = JSON.parse(data)
        console.log('长度',data)
        for (var i = 0, lent = data.length;i<lent;i++){

            var ty = document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[2].querySelector("a")
                ty.setAttribute('href', data[i]['url'])
                ty.text=data[i]['url'].substring(data[i]['url'].length-8)
            if (data[i]['ack']==1) {
                console.log('xx')
                document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[1].classList.add("disaplaied");
                document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[2].querySelectorAll("button")[0].classList.add("disaplaied");
                document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[3].classList.add("disaplaied");
                document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[3].querySelectorAll("button")[0].classList.add("xxxx");

            }
            if (data[i]['time_stemp']) {
                console.log('xxxxxx')
                document.querySelector(".table").querySelectorAll("tr")[data[i]['id']].querySelectorAll("td")[1].querySelector("input").value=data[i]['time_stemp']
            }
        }

    })
    function confirm(that) {
        console.log(document.querySelector(".table").querySelectorAll("tr")[that])
         var thref = location.href
        $.ajax({
            url:'/product/schedule',
            type:"POST",
            data:{"num":that,"key":keysss,"location":thref},
        }).success(function (data) {
            // code 判断
            alert('保存成功，已通知下一环节处理人员');
            document.querySelector(".table").querySelectorAll("tr")[that].querySelectorAll("td")[1].classList.add("disaplaied");
            document.querySelector(".table").querySelectorAll("tr")[that].querySelectorAll("td")[2].classList.add("disaplaied");
            document.querySelector(".table").querySelectorAll("tr")[that].querySelectorAll("td")[3].classList.add("disaplaied");
        })
    }
    function xxx(that) {
        console.log(that)
        document.getElementById("get_value").value = that;

        console.log('that',that)
        //document.getElementById("get_remarks").value = document.querySelector(".table").querySelectorAll("tr")[that].querySelectorAll("td")[3].querySelector("input").value
    }

    function doUploadFile() {
        // 时间戳
        var id = document.getElementById("get_value").value
        var time_stemp = document.querySelector(".table").querySelectorAll("tr")[id].querySelectorAll("td")[1].querySelector("input").value;
        var idd = document.getElementById("get_value").value
        var formData = new FormData();
        formData.append("file", document.getElementById("file").files[0]);
        formData.append("name", 'upload');
        formData.append("key", keysss);
        formData.append("id", idd);
        formData.append("ui_info", document.getElementById("ui_info").value);
        formData.append("ui_time_stemp", time_stemp);
        var thref = location.href
        formData.append("location", thref);

        if (document.getElementById("file").files[0]) {
            $.ajax({
                url: '/product/upload_file',
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
            }).success(function (data) {
                data = JSON.parse(data)
                if (data['code']==0){
                    console.log('上传成功')
                     var ty = document.querySelector(".table").querySelectorAll("tr")[idd].querySelectorAll("td")[2].querySelector("a")
                     ty.setAttribute('href', data['url'])
                     ty.text=data['url'].substring(data['url'].length-8)
                     document.getElementsByClassName("close")[0].click();

                     alert('上传成功')
                }else{
                    document.getElementsByClassName("close")[0].click();
                    alert('上传失败')
                }


            })
        } else {
            alert('不能为空')
        }


    }
</script>



