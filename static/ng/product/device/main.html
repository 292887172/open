<style>
    #no-info{
        display: none;
        top: 162px;
        text-align: center;
        left: 213px;
    }
    .row{
        margin-right: -14px;
        position: relative;
        left: 623px;
        top: 18px;
        color: #808080;
    }
    .hl-help {
        color:#ff6202;
    }
</style>

<script src="/static/js/product/bootbox.js"></script>
<script src="/static/js/ejs.js"></script>
<script type="text/javascript">
    var key='';
    jQuery(function($) {
        var device_list={};
        $.ajax({
            url: location.href,
            type: "POST",
            data: {'device': 'device_table'},
            success: function (data) {

                device_list= data['data'];
                key = data['key'];
                if(! device_list){
                    $("#device-info").css("display","none");
                    $("#barcon").css("display","none");
                    $("#no-info").css("display","block");
                 }
                load_table(device_list);
            },
            error: function (e) {
                alert(e)
            }
        });
        function load_table(device_list) {
            group = new EJS({url: '/static/js/tmpl/device_table.ejs'}).render({"device_list":device_list});
            document.getElementById("device-info").innerHTML=group;

            goPage(1,20);
            console.log(document.getElementById('current-page'));
            // 分页显示
        }

    });
    function DebugDevice(item) {
        // href="https://oven.53iq.com/static/html/control.html?d=<%=device_list[i].ebf_device_mac%
        var mac = $(item).data('mac');

        var dialog = bootbox.dialog({
                    title: '正在申请调试权限',
                    message: '<p><i class="fa fa-spin fa-spinner"></i> Loading...</p>'
                });
        $.ajax({
            url: location.href,
            type: "POST",
            data: {'name': 'save_conf'},
            success: function (data) {
                // dialog.modal('hide');
                if(data['code']== 0){
                    window.location.href = 'https://oven.53iq.com/static/html/controlinternet.html?d='+mac
                }
                else{
                    bootbox.alert(data['msg'])
                }
                console.log(data);

            },
            error: function (e) {
                alert(e)
            },
            complete:function () {
                setTimeout(function () {
                    dialog.modal('hide')
                },1000);
            }
        });

    }
    function goPage(pno,psize) {
            var itable = document.getElementById("table-device");
            var num = itable.rows.length;
            var totalPage = 0;
            var pageSize = psize;
            //总共分几页
            if (num / pageSize > parseInt(num / pageSize)) {
                totalPage = parseInt(num / pageSize) + 1;
            } else {
                totalPage = parseInt(num / pageSize);
            }
            var currentPage = pno;
            var startRow = (currentPage - 1) * pageSize + 1;
            var endRow = currentPage * pageSize;
            endRow = (endRow > num) ? num : endRow;
            //遍历显示数据实现分页
            for (var i = 1; i < (num + 1); i++) {
                var irow = itable.rows[i - 1];
                if (i >= startRow && i <= endRow) {
                    irow.style.display = "";
                } else {
                    irow.style.display = "none";
                }
            }
            var pageEnd = document.getElementById("pageEnd");
            var tempStr = "共" + num +"条记录 ";
            if (currentPage > 1) {
                tempStr += "<a role='button' onclick=\"goPage(" + (1) + "," + psize + ")\"> 首页 </a>&nbsp;";
                tempStr += "<a role='button' onclick=\"goPage(" + (currentPage - 1) + "," + psize + ")\">上一页</a>"
            } else {
                tempStr += " 首页 ";
                tempStr += " 上一页";
            }
            if (currentPage < totalPage) {
                tempStr += "<a role='button' onclick=\"goPage(" + (currentPage + 1) + "," + psize + ")\"> 下一页&nbsp;</a>";
                tempStr += "<a role='button' onclick=\"goPage(" + (totalPage) + "," + psize + ")\"> 尾页&nbsp;</a>";
            } else {
                tempStr += " 下一页>";
                tempStr += " 尾页";
            }
            tempStr += "  第" + currentPage + "页/共"+ totalPage +"页";
            document.getElementById("barcon").innerHTML = tempStr;
        }

</script>

<div class="box2 relative">
    <div class="hl-help">

        <span class="linkBlue">设备管理中心</span>
    </div>
	<div class="mt20">
        <div class="boxInfo">
            <h3 class="tit5">设备管理表</h3>
                <h3 class="tit5" id="no-info" >当前还未绑定任何设备，只需将产品Key写入协议通过握手帧上报，即可查看绑定设备!</h3>
                <div class="panel panel-default" id="device-info" >
                </div>
                 <div class="row" id="barcon">
                </div>
        </div>
    </div>
</div>
<script>
</script>
