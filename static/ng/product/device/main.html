<style>
    #no-info{
        display: none;
        top: 162px;
        text-align: center;
        left: 213px;
    }
    .row{
        margin-right: -14px;
        position: relative;
        left: 623px;
        top: 18px;
        color: #808080;
    }
    .hl-help {
        color:#ff6202;
    }
</style>

<div class="box2 relative">
    <div class="hl-help">

        <span class="linkBlue">设备管理中心</span>
    </div>
	<div class="mt20">
        <div class="boxInfo">
            <h3 class="tit5">设备管理表</h3>

                <div class="loading" style="text-align: center;">
                    <p style="font-size: 16px"><i class="fa fa-spin fa-spinner"></i> 正在做加载中，请稍后...</p>
                </div>
                <h3 class="tit5" id="no-info" >当前还未绑定任何设备，只需将产品Key写入协议通过握手帧上报，即可查看绑定设备!</h3>
                <div class="panel panel-default" id="device-info" >

                </div>
                 <div class="row" id="barcon">
                </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    function load_table(device_list,state) {

        group = '<table class="table table-striped m-b-none">' +
        '<thead> <tr> <th>id</th> <th>mac</th> <th>时间</th> <th>是否在线</th> <th>调试</th> </tr>' +
        '</thead> <tbody id="table-device">';
        for(var i=0;i<device_list.length;i++){
            group += '<tr><td>'+device_list[i].ebf_device_id+'</td>';
            group += '<td>'+device_list[i].ebf_device_mac+'</td>';
            group += '<td>'+device_list[i].ebf_device_create_date+'</td>';
            if(device_list[i].is_online == 0){
                is_online = "离线"
            }
            else{
                is_online = "在线"
            }
            group += '<td>'+is_online+'</td><td>';
            if (device_list[i].ebf_device_mac) {
                group += '<a style="cursor: pointer;" onclick="DebugDevice(this)" data-mac="'+device_list[i].ebf_device_mac+'" target="_blank" >调试</a>'
            }
            group += '</td></tr>'
        }
        group += '</tbody></table>';
        document.getElementById("device-info").innerHTML=group;
        if(state>=1){
            $("td a").css({'pointer-events':'none'});
        }
        goPage(1,20);
        console.log(document.getElementById('current-page'));
        // 分页显示
    }

    function DebugDevice(item) {
        // href="https://oven.53iq.com/static/html/control.html?d=<%=device_list[i].ebf_device_mac%
        var mac = $(item).data('mac');

        var dialog = bootbox.dialog({
                    title: '正在申请调试权限',
                    message: '<p><i class="fa fa-spin fa-spinner"></i> Loading...</p>'
                });
        $.ajax({
            url: location.href,
            type: "POST",
            data: {'name': 'save_conf'},
            success: function (data) {
                dialog.modal('hide');
                if(data['code']== 0){
                    window.location.href = 'https://oven.53iq.com/static/html/controler.html?d='+mac
                }
                else{
                    bootbox.alert(data['msg'])
                }
                console.log(data);

            },
            error: function (e) {
                bootbox.alert(e)
            },
            complete:function () {
                setTimeout(function () {
                    dialog.modal('hide')
                },1000);
            }
        });

    }
    function goPage(pno,psize) {
            var itable = document.getElementById("table-device");
            var num = itable.rows.length;
            var totalPage = 0;
            var pageSize = psize;
            //总共分几页
            if (num / pageSize > parseInt(num / pageSize)) {
                totalPage = parseInt(num / pageSize) + 1;
            } else {
                totalPage = parseInt(num / pageSize);
            }
            var currentPage = pno;
            var startRow = (currentPage - 1) * pageSize + 1;
            var endRow = currentPage * pageSize;
            endRow = (endRow > num) ? num : endRow;
            //遍历显示数据实现分页
            for (var i = 1; i < (num + 1); i++) {
                var irow = itable.rows[i - 1];
                if (i >= startRow && i <= endRow) {
                    irow.style.display = "";
                } else {
                    irow.style.display = "none";
                }
            }
            var pageEnd = document.getElementById("pageEnd");
            var tempStr = "共" + num +"条记录 ";
            if (currentPage > 1) {
                tempStr += "<a role='button' onclick=\"goPage(" + (1) + "," + psize + ")\"> 首页 </a>&nbsp;";
                tempStr += "<a role='button' onclick=\"goPage(" + (currentPage - 1) + "," + psize + ")\">上一页</a>"
            } else {
                tempStr += " 首页 ";
                tempStr += " 上一页";
            }
            if (currentPage < totalPage) {
                tempStr += "<a role='button' onclick=\"goPage(" + (currentPage + 1) + "," + psize + ")\"> 下一页&nbsp;</a>";
                tempStr += "<a role='button' onclick=\"goPage(" + (totalPage) + "," + psize + ")\"> 尾页&nbsp;</a>";
            } else {
                tempStr += " 下一页>";
                tempStr += " 尾页";
            }
            tempStr += "  第" + currentPage + "页/共"+ totalPage +"页";
            document.getElementById("barcon").innerHTML = tempStr;
        }

</script>
