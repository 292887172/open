<style>
    .u208 {
        margin-top: 7px;
        left: 0px;
        top: 0px;
        width: 86px;
        height: 48px;
        background: inherit;
        background-color: rgba(255, 255, 255, 1);
        box-sizing: border-box;
        border-width: 1px;
        border-style: solid;
        border-color: rgba(121, 121, 121, 1);
        border-radius: 0px;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
    }
    .u209 {
        margin-top: 7px;
        width: 98px;
        height: 48px;
        border-width: 1px;
        border-style: solid;
        border-color: rgba(121, 121, 121, 1);
        border-radius: 0px;
    }
    .xinput{
        margin-left: 0px;
        padding: 0px;
        width: 24px;
        height: 24px;

    }
    select{
        padding: 0 4px;
    }

    input {
        display: inline;
        background-color: white !important;
        margin-top: 10px;
        margin-left: 10px;
        width: 44px;
        border-top-width: 0px;
        border-left-width: 0px;
        border-bottom-width: 0px;
        border-right-width: 0px;

    }
    .btnn{
        width: 135px;
    height: 42px;
    color: white;
    background-color: #ff6202;
    border: 0;
    border-radius: 4px;
    }
    .btnn:active,.btnn:hover{
        opacity: 0.65;
    }
    /*预览帧样式*/
    .num {
      width: 76px;
      /*height: 50px;*/
      text-align: center;
      /*line-height: 50px;*/
      border: 1px solid #c3c3c3;
      background-color: #FEDCD2;
      border-radius: 10px;
      margin-right: 5px;
      color: #333;
    }
    .num:nth-child(2){
       background-color: #BFD8D2;
     }

    .num:nth-last-child(1){
       background-color: #DF744A;
     }
    .num-title,.num-val{height: 20px;line-height: 1.5}
    .num-title{border-bottom: 1px solid #333}
    .protocol-pre{
        display: flex;
    flex-wrap: wrap;
    border: 1px solid #ccc;
    padding: 5px;
        margin-top: 67px;
    margin-left: 100px;
    }
    .pre-title{
        width: 100%;
        height: 20px;
        font-size: 17px;
        margin-top: 10px;
        color: #939192;
    }
    /*end*/

    .delete{
        width:15px;
        height:15px;
        top: 0px;
        margin-left: 96px;
        border-radius:15px;
        position:absolute;
        z-index:1;
    }
    .delete1{
        width:15px;
        height:15px;
        top: -6px;
        right: -6px;
        border-radius:15px;
        position:absolute;
        z-index:1;
    }
    .x11x{
        position: relative;
    }

    #div_add{
        position: relative;
    }
    /* 遮罩层*/
    .black_overlay{
    display: none;
    position: absolute;
    top: 0%;
    left: 0%;
    width: 100%;
    height: 100%;
    background-color: #4c4c4c;
    z-index:1001;
    -moz-opacity: 0.8;
    opacity:.80;
    filter: alpha(opacity=80);
    }
    .white_content {
    display: none;
    position: absolute;
    top: 30%;
    left: 40%;
    width: 30%;
    height: 20%;
    border: 2px solid lightblue;
    background-color: white;
    z-index:1002;
    overflow: auto;
    }
    .white_content_small {
    display: none;
    position: absolute;
    top: 20%;
    left: 30%;
    width: 40%;
    height: 50%;
    border: 16px solid lightblue;
    background-color: white;
    z-index:1002;
    overflow: auto;
    }
</style>
<script>

    function Iclose(b){
        var parentNode1 = b.parentNode.parentNode;
        parentNode1.remove()
    }
    function Iclose1(a){
        var parentNode = a.parentNode;
        parentNode.remove()
    }
    function New_add(c) {
        var t = c.parentNode;
        var tt = c.parentNode.parentNode;

        var newDiv1 = document.createElement("div");
        newDiv1.className="u208 col-md-2 new_class";
        newDiv1.style="margin-left: 10px;padding-left: 0px;padding-right: 0px";
        newDiv1.innerHTML=
            '                    <img src="http://www.iconpng.com/download/png/65501" class="delete1 ids" id="delete1" onclick="Iclose1(this)"/>\n' +
            '                    <input style="display: block;margin-top: 3px;margin-left: 0px;width: 84px;text-align: center"placeholder="描述名称" value="">\n' +
            '                    <input id=\'input_1\' class="bianji" placeholder="0" style="margin-left: 21px;margin-top:3px;text-align: center"\n' +
            '                           value="">\n' +
            '\n'
            ;
       tt.insertBefore(newDiv1, t);
    }
    //增加第二版
    function New_add_title(c) {
        var t = c.parentNode;
        var tt = c.parentNode.parentNode;
        var mak = {"故障报警帧": "FF", "全指令控制帧": "21", "心跳帧": "00"};

        var new_data_list= [];
        var ttt = document.getElementsByClassName("code-items")
        for (var t_key=0, l = ttt.length; t_key<l; t_key++) {
            var key = ttt[t_key].getElementsByTagName("span")[0].innerText;
            var valuez = ttt[t_key].getElementsByTagName("input")[0].value;
            console.log(mak[key])
            delete mak[key]
            new_data_list.push(valuez)
        }
        console.log(mak)
        var keyss=[]
        for (var p in mak){
            keyss.push(p)
        }
        console.log(new_data_list.length)
        if (new_data_list.length === 3){
            alert('暂时无法添加功能')
        }
        else{

            var newDiv1 = document.createElement("div");
            newDiv1.className="u208 col-md-2 new_class";
            newDiv1.style="margin-left: 10px;padding-left: 0px;padding-right: 0px";
            newDiv1.innerHTML=
                '                    <img src="http://www.iconpng.com/download/png/65501" class="delete1 ids" id="delete1" onclick="Iclose1(this)"/>\n' +
                '                    <input style="display: block;margin-top: 3px;margin-left: 0px;width: 84px;text-align: center"placeholder="描述名称" value="'+ keyss[0] +'">\n' +
                '                    <input id=\'input_1\' class="bianji" placeholder="0" style="margin-left: 21px;margin-top:3px;text-align: center"\n' +
                '                           value="'+ mak[keyss[0]] +'">\n' +
                '\n'
                ;
            tt.insertBefore(newDiv1, t);
        }

    }
    //弹出隐藏层
    function ShowDiv(show_div,bg_div){
    document.getElementById(show_div).style.display='block';
    document.getElementById(bg_div).style.display='block' ;
    var bgdiv = document.getElementById(bg_div);
    bgdiv.style.width = document.body.scrollWidth;
    // bgdiv.style.height = $(document).height();
    $("#"+bg_div).height($(document).height());
    };
    //关闭弹出层
    function CloseDiv(show_div,bg_div)
    {
    document.getElementById(show_div).style.display='none';
    document.getElementById(bg_div).style.display='none';
    };

    function SubmitProtocol1(show_div,bg_div) {

        document.getElementById(show_div).style.display='none';
        document.getElementById(bg_div).style.display='none';
        if (document.getElementById("x_x").selected) {
            console.log('下行')
            document.getElementsByClassName("code-item")[0].getElementsByTagName("input")[0].value = "5AA5";
            document.getElementsByClassName("code-item")[0].getElementsByTagName("span")[0].innerText = "发送码"
            }
        if (document.getElementById("s_x").selected) {
            console.log('上行')
            document.getElementsByClassName("code-item")[0].getElementsByTagName("input")[0].value = "A55A";
            document.getElementsByClassName("code-item")[0].getElementsByTagName("span")[0].innerText = "发送码"
        }
        angular.element("#sbt").click();
    }
</script>

<div class="box2 relative" ng-app="Product.protocol" ng-controller="ProtocolCtrl" id="mainDiv1">

    <div class="hl-help">
        <span class="linkBlue" style="font-size:13px">定义协议</span>
    </div>
    <hr style="height: 20px;margin-top: 17px;border-top-width: 1px;">
    <div class="hl-help">
        <span class="linkBlue" style="color: #333333">协议选择:</span>

    </div>

    <hr>
    <div class="" style="margin-left: 50px">
        <div class="col-md-4" style="display: inline;width: 300px;margin-left: 50px;padding-left:0px">
            <input type="radio" name="xx" class="standard"  value="standard" id="standard-item" ng-click="BzProtocol()"><p style="font-size: 30px;margin-left: 25px">标准协议</p>
        </div>
        <div class="" style="display: inline;margin-left: 50px">
            <input type="radio" name="xx" class="custom" value="custom" id="custom-item" ng-click="ZdyProtocol()"><p style="font-size: 30px;margin-left: 420px">自定义协议</p>
        </div>

    </div>

    <br>
    <div class="hl-help" style="margin-top: 20px;color: #333333">
        协议帧定义:
    </div>
    <hr>
    <div class="hl-help" style="margin-top: 15px;color: #333333">
        协议分类
    </div>
     <select disabled="disabled" style="display: block;margin-top: 7px;margin-left:100px;height: 25px;width: 103px"  name="condition" id="select_id" class="bianji">
                <option value="0" id="s_x" ng-selected="response.protocol_type=='0'">MCU到云端</option>
                <option value="1" id="x_x" ng-selected="response.protocol_type=='1'" selected>云端到MCU</option>
     </select>
    <hr>
    <div class="x1x" style="margin-top: 10px;margin-left: 100px;height: 100px" ng-drop="true" ng-drop-success="dropComplete($index,$data)" ng-drag="true" ng-drag-data="x" ng-repeat="x in response.frame_content" id='div_add' data-name="{[{ x.name }]}" ng-if="x.is_enable==true || x.is_enable=='true'">
        <input style="margin-left: 0px;font-size: larger;width: 100px" readonly="readonly" value="{[{ x.title }]}">
        <input type="checkbox" class="ids taf" checked style="margin-left: 30px;display: none" ng-if="x.is_enable==true || x.is_enable=='true'" >
        <input type="checkbox" class="ids taf" style="margin-left: 30px;display: none" ng-if="x.is_enable==false || x.is_enable=='false'">
        <span
            class="ids" style="display: none">启用</span>
        <br>
        <br>
        <div id="x5x">
            <div class="u208 col-md-2">
                <span style="display: block;margin-top: 11px;margin-left: 15px;width: 74px">序号</span>
                <input id='input_1' class="bianji" disabled="disabled" placeholder="0" style="margin-left: 24px" value="{[{ x.number }]}">
            </div>
            <div class="u208 col-md-2 " style="margin-left: 10px">
                <span style="display: block;margin-top: 11px;margin-left: 15px;width: 74px">长度</span>

                <select style="display: block;margin-top: 7px;height: 25px;width: 70px" disabled="disabled" class="bianji xlk" name="checkout_length" id="select_length" onchange="show_or_hide(this.value)">
                    <option value="1" selected ng-selected="x.length =='1'">1bit</option>
                    <option value="2" ng-selected="x.length =='2'">2bit</option>
                    <option value="3" ng-selected="x.length =='3'">3bit</option>
                    <option value="4" ng-selected="x.length =='4'">4bit</option>
                </select>
            </div>
            <div ng-if="x.code.length < 2" >
                <div class="u209 col-md-2 code-item "  id="del_c" style="margin-left: 10px;padding-left: 0px;padding-right: 0px"
                     ng-repeat="c in x.code" ng-if="c.value" data-type="{[{ c.type}]}">
                    <img src="http://www.iconpng.com/download/png/65501" class="delete1 ids" id="delete1" onclick="Iclose1(this)"/>
                    <span style="display: block;margin-top: 11px;width: 84px;text-align: center"> {[{ c.desc}]}</span>
                    <input type="text" placeholder="1" disabled="disabled" class="xinput bblchk"><input type="text" placeholder="2" disabled="disabled" class="xinput bblchk"><input type="text" placeholder="3" disabled="disabled" class="xinput bblchk" style="display: none"><input type="text" placeholder="4" disabled="disabled" class="xinput bblchk" style="display: none">
                </div>

            </div>
            <div ng-if="x.code.length > 2" >
                <div class="u208 col-md-2 code-item code-items"  id="del_c" style="margin-left: 10px;padding-left: 0px;padding-right: 0px"
                     ng-repeat="c in x.code" ng-if="c.value" data-type="{[{ c.type}]}">
                    <img src="http://www.iconpng.com/download/png/65501" class="delete1 ids" id="delete1" onclick="Iclose1(this)"/>
                    <span style="display: block;margin-top: 11px;width: 84px;text-align: center"> {[{ c.desc}]}</span>
                    <input id='input_1' class="bianji" disabled="disabled" placeholder="0" style="margin-left: 21px;text-align: center"
                           value="{[{ c.value }]}">

                </div>

            </div>

            <div ng-if="x.code.length > 2" class="ids" id="x4x">
                 <!--<img src="/static/image/product/add.png" alt="" style="margin-top: 5px;margin-left: 22px;width: 48px;" id="new_add" onclick="New_add(this)">-->
                 <img src="/static/image/product/add.png" alt="" style="margin-top: 5px;margin-left: 22px;width: 48px;" id="new_add" onclick="New_add_title(this)">
            </div>

        </div>

        <hr style="height: 8px;margin-top: 60px;border-top-width: 3px;" ng-if ="!$last">
    </div>

    <div style="margin-left: 90px;margin-top: 60px" id="x3x">
        <div class="u208 col-md-2" id="x2x" style="margin-left: 10px" >
            <span style="display: block;margin-top: 11px;margin-left: 5px;width: 74px">算法校验</span>
            <select style="display: block;margin-top: 7px;height: 25px;width: 70px" disabled="disabled" class="bianji" name="checkout_algorithm" id="select_option">
                <option value="sum">SUM(加和效验)</option>
                <option value="crc-8" ng-selected="response.checkout_algorithm=='crc-8'">CRC-8</option>
                <option value="crc-16" ng-selected="response.checkout_algorithm=='crc-16'">CRC-16</option>
            </select>

        </div>
        <div class="u208 col-md-2 col-md-offset-2" style="margin-left: 10px" >
            <span style="display: block;margin-top: 11px;width: 74px;padding-left: 0px;padding-right: 0px">起始检验位</span>
            <input id='input_04' class="bianji" placeholder="0" style="text-align: center"
                               value="{[{ response.start_check_number}]}">

        </div>
        <div class="u208 col-md-2 col-md-offset-2" style="margin-left: 10px" >
            <span style="display: block;margin-top: 11px;width: 74px;padding-left: 0px;padding-right: 0px">结束检验位</span>
            <input id='input_05' class="bianji" placeholder="0" style="text-align: center"
                               value="{[{ response.end_check_number}]}">

        </div>
    </div>
    <br>
    <div class="protocol-pre" style="display: flex;flex-wrap:wrap;">
        <p class="pre-title">协议格式预览</p>
        <div class="num" ng-repeat="x in list_mode">
          <div class="num-title">{[{x.title}]}</div>
          <div class="num-val">{[{x.val}]}</div>
        </div>
    </div>
    <div style="margin-top: 60px;text-align: center">

        <button type="submit" id="newpro" class="btn-s-xs btnn ids" style="display: none" >新增协议
                        </button>

        <button type="submit" class="btn-s-xs btnn ids" id="sbt" ng-click="SubmitProtocol()" >保存</button>

     </div>
</div>
<!--弹出层时背景层DIV-->
<div id="fade" class="black_overlay">
</div>
<div id="MyDiv" class="white_content">
    <div style="text-align: right; cursor: default; height: 40px;padding-top: 10px">
        <span style="font-size: 16px" onclick="CloseDiv('MyDiv','fade')">关闭</span>
    </div>
    <div style="margin-top: 45px;margin-left: 65px">
        是否对以编辑对内容进行保存？
    </div>
    <button style="margin-top: 40px;margin-left: 40px" type="submit" class="btn-s-xs btnn" onclick="SubmitProtocol1('MyDiv','fade')" >确认</button>
    <button type="submit" class="btn-s-xs btnn" onclick="CloseDiv('MyDiv','fade')">取消</button>

</div>

<script>
    $(document).ready(function () {

        $("#select_id").change(function () {
            ShowDiv('MyDiv','fade');

        })

    })

    $(".custom").on('click', function () {

        var list = document.getElementsByClassName("ids");
        for (var i = 0, l = list.length; i < l; i++) {
            var obj = list[i];
            obj.style.display = '';
        }
        var list1 = document.getElementsByClassName("bianji");
        for (var ii = 0, ll = list1.length; ii < ll; ii++) {
            $('input[class=bianji]').removeAttr("disabled");
        }
        var list11 = document.getElementsByClassName("bblchk");
        for (var iii = 0, lll = list11.length; iii < lll; iii++) {
            console.log(list11[iii]);
            list11[iii].disabled=false;
        }
        var list111 = document.getElementsByClassName("baf");
        for (var iiii = 0, llll = list111.length; iiii < llll; iiii++) {
            list111[iiii].disabled='false';
        }
        var select_option = document.getElementsByTagName("select")[0];
        select_option.disabled=false;
        var select_option1 = document.getElementById("select_length");
        select_option1.disabled=false;

    });
    $(".standard").on('click', function () {

        var lis = document.getElementsByClassName("ids");
        for (var j = 0, l = lis.length; j < l; j++) {
            var obj = lis[j];
            obj.style.display = 'none';
        }
        var lis1 = document.getElementsByClassName("bianji");
        for (var jj = 0, ll = lis1.length; jj < ll; jj++) {
            $('input[class=bianji]').attr("disabled","disabled");
        }
        var lis11 = document.getElementsByClassName("bblchk");
        for (var jjj = 0, lll = lis11.length; jjj < lll; jjj++) {
            lis11[jjj].disabled=true;
        }
        var select_option = document.getElementsByTagName("select")[0];
        select_option.disabled=true;
        var select_option1 = document.getElementById("select_length");
        select_option1.disabled=true;
    });
    $("#newpro").on('click',function () {

        var newDiv = document.createElement("div");
        newDiv.className="x11x";
        newDiv.setAttribute("id",'x11x');
        newDiv.style="margin-top:50px;margin-left:100px";
        newDiv.innerHTML=
            '<input style="margin-left: 0px;font-size: larger;width: 800px" placeholder="自定义协议名称" value="">\n' +

            '        <br>\n' +
            '        <br>\n' +
            '        <div>\n' +
            '            <div class="u208 col-md-2">\n' +

            '                <span style="display: block;margin-top: 11px;margin-left: 15px;width: 74px">序号</span>\n' +
            '                <input id=\'input_1\' class="bianji" placeholder="0" style="margin-left: 24px" value="">\n' +
            '            </div>\n' +
            '            <div class="u208 col-md-2 " style="margin-left: 10px">\n' +
            '                <span style="display: block;margin-top: 11px;margin-left: 15px;width: 74px">长度</span>\n' +
            '                <input id=\'input_1\' class="bianji" placeholder="0" style="margin-left: 24px" value="">\n' +
            '            </div>\n' +
            '<img src="http://www.iconpng.com/download/png/65501" class="delete" id="delete" onclick="Iclose(this)"/>' +
            '            <div class="u208 col-md-2 " id="keyven" style="margin-left: 10px">\n' +
            '                <input style="display: block;width: 70px;margin-top:3px;margin-left:0px" placeholder="自定义参数">\n' +
            '                <input id=\'input_1\' class="bianji" placeholder="0" style="margin-left: 20px;margin-top:0px" value="">\n' +
            '            </div>\n' +

            '\n' +

            '    </div>';


        var oldDiv = document.getElementById("mainDiv1");
        var ooDiv = document.getElementById("x3x");
        oldDiv.insertBefore(newDiv, ooDiv);

    })

    function foo(){
             if(document.getElementById("custom-item").checked) {
                console.log('zidingyi')
                var list = document.getElementsByClassName("ids");
                for (var i = 0, l = list.length; i < l; i++) {
                    var obj = list[i];
                    obj.style.display = '';
                }
                var list1 = document.getElementsByClassName("bianji");
                for (var ii = 0, ll = list1.length; ii < ll; ii++) {
                    $('input[class=bianji]').removeAttr("disabled");
                }
                var list11 = document.getElementsByClassName("bblchk");
                for (var iii = 0, lll = list11.length; iii < lll; iii++) {

                    list11[iii].disabled=false;
                }
                var list111 = document.getElementsByClassName("baf");
                for (var iiii = 0, llll = list111.length; iiii < llll; iiii++) {
                    list111[iiii].disabled='false';
                }

                var select_option = document.getElementsByTagName("select");
                for (var y =0, ls =select_option.length; y<ls; y++ )
                    select_option[y].disabled=false;

            }else {
                console.log('biaozhun')
                var lis = document.getElementsByClassName("ids");
                for (var j = 0, lzz = lis.length; j < lzz; j++) {
                    var obj3 = lis[j];
                    obj3.style.display = 'none';
                }
                console.log('yy')
                var lis1 = document.getElementsByClassName("bianji");
                for (var jj = 0, llzz = lis1.length; jj < llzz; jj++) {
                    $('input[class=bianji]').attr("disabled", "disabled");
                }
                var lis11 = document.getElementsByClassName("bblchk");
                for (var jjj = 0, lllzz = lis11.length; jjj < lllzz; jjj++) {
                    lis11[jjj].disabled = true;
                }
          }
        }
    function f1() {


        if (document.getElementById("x_x").selected) {
            var list = document.getElementsByClassName("ids");
            for (var i = 0, l = list.length; i < l; i++) {
                var obj = list[i];
                obj.style.display = '';
            }
            var list1 = document.getElementsByClassName("bianji");
            for (var ii = 0, ll = list1.length; ii < ll; ii++) {
                $('input[class=bianji]').removeAttr("disabled");
            }
            var select_option = document.getElementsByTagName("select");
            for (var y = 0, ls = select_option.length; y < ls; y++)
                select_option[y].disabled = false;
            document.getElementsByClassName("code-item")[0].getElementsByTagName("input")[0].value = "5AA5";
            document.getElementsByClassName("code-item")[0].getElementsByTagName("span")[0].innerText = "发送码"
        }
        if (document.getElementById("s_x").selected) {
            var list = document.getElementsByClassName("ids");
            for (var i = 0, l = list.length; i < l; i++) {
                var obj = list[i];
                obj.style.display = '';
            }
            var list1 = document.getElementsByClassName("bianji");
            for (var ii = 0, ll = list1.length; ii < ll; ii++) {
                $('input[class=bianji]').removeAttr("disabled");
            }
            var select_option = document.getElementsByTagName("select");
            for (var y = 0, ls = select_option.length; y < ls; y++)
                select_option[y].disabled = false;
            document.getElementsByClassName("code-item")[0].getElementsByTagName("input")[0].value = "A55A";
            document.getElementsByClassName("code-item")[0].getElementsByTagName("span")[0].innerText = "发送码"
        }
    }
    function show_or_hide(v) {
        console.log(v)
        if (v=="1") {
                console.log('1')
                document.getElementsByClassName("u209")[0].getElementsByTagName("input")[0].style.display='';
                document.getElementsByClassName("u209")[0].getElementsByTagName("input")[1].style.display='none';
                document.getElementsByClassName("u209")[0].getElementsByTagName("input")[2].style.display='none';
                document.getElementsByClassName("u209")[0].getElementsByTagName("input")[3].style.display='none';
            }
        else if (v=="2") {
            console.log('2')
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[0].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[1].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[2].style.display='none';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[3].style.display='none';
        }
        else if (v=="3") {
            console.log('3')
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[0].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[1].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[2].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[3].style.display='none';
        }
        else if (v=="4") {
            console.log('4')
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[0].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[1].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[2].style.display='';
            document.getElementsByClassName("u209")[0].getElementsByTagName("input")[3].style.display='';
        }
    }



</script>