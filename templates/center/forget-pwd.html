{% extends 'center/base.tpl' %}
{% load staticfiles %}
{% block title %}
    找回密码
{% endblock %}
{% block style %}
    {#    <link rel="stylesheet" href="http://io.device.53iq.com/static/web/css/theme.css"/>#}
    {#    <link rel="stylesheet" href="http://io.device.53iq.com/static/web/css/font-awesome.min.css"/>#}
    <link rel="stylesheet" href="{% static 'bootstrap/app.css' %}"/>
    <link rel="stylesheet" href="{% static 'theme/bsplus/css/simple-line-icons.css' %}"/>
    <style>
        .container-narrow {
            width: 95%;
            max-width: 710px;
            margin: 5% auto;
        }

        .widget-header > i {
            font-size: 16px;
            padding: 15px 10px 15px 11px;
            text-align: center;
            width: 40px;
        }

        .widget-header h5 {
            margin: 0;
            padding: 15px 0 0;
            font-size: 16px;
            float: left;
            color: #62687e;
            font-weight: 200;
            text-indent: 2em;
        }

        .widget-header {
            background-color: #efefef;
            -moz-border-radius: 3px 3px 0 0;
            -webkit-border-radius: 3px 3px 0 0;
            border-radius: 3px 3px 0 0;
            min-height: 51px;
            border: 1px solid #DDDDDD;
            width: 710px;
        }

        .widget-body {
            padding: 0;
            border-style: solid;
            border-width: 0 1px 1px;
            border-color: #ccc;
            background-color: #fff;
            width: 660px;
        }

        .col-sm-9 {
            width: 50%;
            position: relative;
        }

        .col-sm-3 {
            width: 135px;
        }

        .col-sm-6 {
            width: 430px;
        }


        a {
            color: #428bca;
        }

        .btn {
            border-radius: 2px;
            background-image: none !important;
            border-color: rgba(0, 0, 0, 0.15) rgba(0, 0, 0, 0.15) rgba(0, 0, 0, 0.25);
        }

        .btn-large {
            padding: 5px 19px;
            font-size: 17.5px;
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
        }

        .btn-block {
            display: block;
            width: 275px;
            margin-left: 95px;
            padding-right: 0;
            padding-left: 0;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;

        }

        legend {
            border-bottom: initial !important;
        }

        .ui-loading-img {
            position: relative;
            top: -36px;
            width: 33px;
            height: 33px;
            left: 58%;
            display: none;
        }

        .ui-error-text {
            position: absolute;
            top: 4px;
            left: 95%;
            width: 114px;
            font-size: 12px !important;
        }

        .ui-from-validate {
            width: 75px;
        }

        .btn-identify {
            position: relative;
            top: -34px;
            left: 36%;
        }
        .ui-validate-text{
            position: relative;
            top: -34px;
            left: 42%;
        }
        .ui-error-text-red {
            color: #f00 !important;
        }

        .ui-input-red {
            border: 1px solid #f00 !important;
        }
    .rg-form-left ul{
        height: 40px;

    }
    .rg-form-left ul li{
        display: inline-block;
        float: left;
        width: 33%;
        line-height: 40px;

        color: #666;

        text-align: center;
        font-size: 15px;
    }
    .cur{

        color: #fff!important;
    }
    .ui-steps{
        background: url("{% static 'image/center/step1.jpg' %}") no-repeat center;
    }
    .footer{
        background: initial;
    }
    .col-sm-9 a{
        position: relative;
        top:-25px;
        left: 102px;
    }
    .col-sm-9 a:hover{
        color: #428bca;
        text-decoration: underline;
    }
    .btn-block{
            position: relative;
            background: #ff6f37;
            color: #fff;
        }
    .btn-block:hover,.btn-block:active,.btn-block:focus{
        color: #fff;
        font-weight: 500;
        background: #ff6202;
    }
    </style>
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="row-fluid">
                    <div class="widget container-narrow">
                        <div class="widget-header">
                            <i class="icon-edit"></i>
                            <h5>找回密码</h5>
                        </div>
                        <div class="widget-body clearfix" style="padding:25px;">
                            <div class="rg-form-left">

                                <input type="hidden" name="csrfmiddlewaretoken"
                                       value="VBEpbyLRhNzRSTmaP1VPY0FmsY9QHfRS">

                                <ul class="ui-steps">
                                    <li class="cur">① 确认账号</li><li>② 安全验证</li><li>③ 重置密码</li>
                                </ul>


                                    <div class="col-sm-6">

                                        <form method="post" enctype="multipart/form-data"
                                              class="form-horizontal">
                                            <div>

                                                <div class="panel-body">
                                                    <div class="line line-dashed b-b line-lg pull-in"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label"><em>*</em> 账户名：</label>

                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" id="ui-account-text"
                                                                   name="username">

                                                            <p class="ui-error-text" id="ui-account-error">
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="line line-dashed b-b line-lg pull-in"></div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label"><em>*</em> 验证码：</label>

                                                        <div class="col-sm-9">
                                                            <input type="text"
                                                                   class="form-control ui-from-validate"
                                                                   placeholder="验证码"
                                                                   id="ui-validate_code"
                                                                   name="validate">
                                                            <img class="ui-error-text ui-validate-text"
                                                                                src="validate_code"
                                                                                onclick="this.src='validate_code?v='+Math.random();"
                                                                                title="点击更换验证码"
                                                                                style="cursor:pointer;vertical-align: middle;height: 37px;width: 129px;"
                                                                                alt="验证码"/>
                                                            <a href="javascript:void(0)" onclick="$('.ui-validate-text').click()" title="看不清，换一换">换一换</a>
                                                            <p style="left: 102%!important;" class="ui-error-text"
                                                               id="ui-code-error"></p>
                                                        </div>
                                                    </div>

                                                </div>

                                            </div>
                                        </form>
                                    </div>


                                <button style="position: relative" type="button" class="btn btn-large btn-block"
                                        id="btnSave">确认
                                </button>
                                <img class="ui-loading-img" src="{% static 'image/ajax-loader.gif' %}"></div>


                        </div>
                    </div>
                </div>
                <!--/row-fluid-->
            </div>
            <!--/span10-->
        </div>
        <!--/row-fluid-->
    </div>
{% endblock %}

{% block script %}
    <script src="{% static 'js/product/page_product_list.js' %}"></script>
    <script>
        $(function () {
            $("#btnSave").click(function () {
                var tel = $("#ui-account-text").val();

                var code = $("#ui-validate_code").val();
                    if (tel) {
                        if (code) {
                            var data_obj = {
                                'type' : 'first',
                                'user_id': tel,
                                'code': code
                            };
                            $.ajax({
                                url: "{% url 'forget_pwd' %}",
                                type: "POST",
                                data: data_obj,
                                error: function () {
                                    $("#btnSave").text("确认");
                                    $(".ui-loading-img").hide();
{#                                    console.log("error");#}
                                },
                                beforeSend: function (xhr, settings) {
                                    $("#btnSave").text('验证中');
                                    $(".ui-loading-img").show();
                                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                                     }
                                 },
                                success: function (response) {
                                    response = jQuery.parseJSON(response);

                                    if (response['status'] == 1) {
                                        url = response['url'];
                                        window.location.href = url;
                                    }
                                    else{
                                        $("#btnSave").text("确认");
                                        $(".ui-loading-img").hide();
                                        alert(response['error'])
                                    }

                                }

                            });
                        }
                        else{
                            $("#ui-validate_code").addClass('ui-input-red');
                            $("#ui-code-error").addClass('ui-error-text-red').text('请正确填写验证码');

                        }
                    }
                })
            });
    </script>
{% endblock %}