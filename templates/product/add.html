{% extends "product/base.tpl" %}
{% load staticfiles %}

{% block title %}
    产品管理
{% endblock %}

{% block style %}
    <link rel="stylesheet" href="{% static 'common/css/app.css' %}"/>
    <link rel="stylesheet" href="{% static 'common/css/font-awesome.min.css' %}"/>
    <style>
        .wrapper {
            width: 1200px;
            padding: 0;
            margin: 0 auto;
        }

        .mt20 {
            margin-top: 20px;
        }

        .goods span {
            height: 30px;
        }

        .nav > li > a {
            position: relative;
            display: block;

        }

        .nav > li > a:hover {

            background: transparent;
        }

        .vague {
            width: 360px;
            max-height: 280px;
            overflow: auto;
            position: absolute;

            border: #ddd 1px solid;
            z-index: 999;
            background: #fff;
        }

        .vague li {
            height: 30px;
            line-height: 30px;
            padding: 0 10px;
            color: #999;
            cursor: pointer;
        }

        .label-command {
            left: 20px;
            position: relative;
            color: #999;
            top: 26px;
            left: -99px;
        }

        .nav-current {
            text-decoration: none;
            border-bottom: 3px solid #ff6202;
            height: 35px;
        }
    .scheme dl {
        float: left;
        width: 228px;
        border: #D8D8D8 1px solid;
        position: relative;
        margin: 8px;
        text-align: center;
        padding: 40px 0 15px;
        box-sizing: border-box;
    }
    .scheme dl.cur {
        border: #4B8DE5 2px solid;
        margin: 7px 8px;
    }
    .breadcrumb{
        font-size: 16px;
        line-height: 0px;
        background-color: transparent;
        margin: 6px 22px 0 12px;
        padding: 0;
        color: #333;
        display: inline-block;
        border-radius: 0;
        border: none;
    }
    .breadcrumb>li+li:before {
    font-family: FontAwesome;
    font-size: 14px;
    content: "\f105";
    color: #B2B6BF;
    margin: 0 8px 0 0;
    position: relative;
    top: 1px;
}
    .sign_out{
            cursor: pointer;
        }
    </style>
{% endblock %}

{% block menu %}

    <li><a href="{% url 'home' %}">首页</a></li>
    <li class="cur"><a class="nav-current" href="{% url "product/list" %}">产品管理</a></li>
    <li><a href="{% url 'wiki' %}">开发指南</a></li>


{% endblock %}

{% block content %}
    <div class="title">
        <div class="wrapper">
            <ol class="breadcrumb">
                <li><a href="/product/list/">产品管理</a></li>

                <li>
                    <a style="color: #ff6202" href="/product/add/">添加产品</a>
                </li>
            </ol>
        </div>
    </div>
    <div class="wrapper mt20">
        <div class="contbox">
            <div class="box3 fn-clear add_newProduct_main">
                <div class="add_newProduct_box">
                    <h3 class="pmTit">添加新产品</h3>

                    <div>
                        <form action="" method="POST" name="productAddForm">
                            {% csrf_token %}
                            <div style="float: left;width: 53%">
                                <input type="hidden" name="developer_id" value="{{ developer.developer_id }}"/>
                                <input type="hidden" name="product_describe" value="hello world"/>
                                <h4 class="infoTit">填写基本信息</h4>
                                <dl class="fmInfo">
                                    <dt>分类</dt>
                                    <dd>
                                        智能家居 /
                                        <select name="product_category" id="product_category" class="sel1" onblur="check_category(this)">
                                            <option value="无">请选择分类</option>
                                            {#                                        <option value="家电类">家电类</option>#}
                                            <option value="厨房类">厨房类</option>
{#                                            <option value="卫浴类">卫浴类</option>#}
                                            {#                                        <option value="环境类">环境类</option>#}
                                        </select>
                                        <select name="product_category_detail" id="product_category_detail"
                                                class="sel2">
                                            <option value="无">请选择分类</option>
                                        </select>
                                    </dd>

                                </dl>
                                <span style="color: red;display: none;padding-left: 172px;" class="check-sel">请选择产品分类</span>
                                <dl class="fmInfo">
                                    <dt>产品名称</dt>
                                    <dd>
                                        <input type="text" name="product_name" id="productNameText" maxlength="18"
                                               class="w280 form-control" onblur="check_app_name(this)" placeholder="请填写产品名称">
                                        <span class="tips-error hiden" id="productNameTips"></span>
                                    </dd>
                                </dl>
                                <span style="color: red;display: none;padding-left: 100px;" class="check-appname">请填写产品名称</span>
                                <dl class="fmInfo">
                                    <dt>品牌</dt>
                                    <dd>
                                        <input type="hidden" name="brand_id" id="brand_id">
                                        <input type="text" name="brandName" id="brandNameText" value="暂无品牌" maxlength="18"
                                               class="w280 form-control" placeholder="品牌名称"
                                               onclick="showBrandList('brandAddUl');"
                                               onkeyup="showBrandList('brandAddUl', this.value)">
                                        <span class="tips-error hiden" id="brandNameTips"></span>
                                        <ul id="brandAddUl" class="vague" onmouseover="this.style.display='';"
                                            onmouseout="this.style.display='none';" style="display: none;"></ul>
                                    </dd>
                                </dl>
                                <dl class="fmInfo">
                                    <dt>型号</dt>
                                    <dd>
                                        <input type="text" name="product_model" id="productModelText" maxlength="48"
                                               class="w280 form-control" placeholder="请填写型号，如：A1">
                                        <span class="tips-error hiden" id="productModelTips"></span>
                                    </dd>
                                </dl>

                                <dl class="fmInfo" id="command-type">
                                    <dt>指令类型</dt>
                                    <dd>
                                        <input type="text" name="product_group" id="product_group" maxlength="48"
                                               class="w280 form-control hidden" placeholder="产品类型" value="2">
                                        <select name="product_command" onclick="showHide()" id="product_command"
                                                ng-disabled="{[{ disabled }]}" class="sel2" style="width:96px;">
                                            <option value="是" selected="selected">全指令</option>
                                            <option value="否">单指令</option>
                                        </select>
                                        <label id="my-label-1" class="label-command"
                                               style="display: none;">支持单个原子功能独立控制</label>
                                        <label id="my-label-2" class="label-command">每个数据帧都要传输所有原子功能状态</label>
                                    </dd>
                                </dl>
                            </div>
                            <div style="float: right;width: 47%">
                                <h4 class="infoTit02">
                                    选择技术方案 <span class="f12">（后期可自由进行WiFi/Android方案的0开发成本自由切换）</span>
                                </h4>
                                <div class="scheme">
                                    <dl class="cur plan" onclick="selectScheme(this, 2)" id="f1">
                                        <dt><img src="{% static 'image/product/wifi.png' %}"><i class="icon-selected"></i></dt>
                                        <dd>WiFi方案要求设备支持5V供电，两路串口，适用于集成灶，油烟机</dd>
                                    </dl>

                                    <dl onclick="selectScheme(this, 1)" id="f3" class="plan">
                                        <dt><img src="{% static 'image/product/android.png' %}"><i class="icon-selected"></i></dt>
                                        <dd>Android屏方案要求设备支持5V供电，一路串口，适用于烤箱，冰箱</dd>
                                    </dl>
                                </div>
                                <span class="tips-error hiden" id="productPlanTips" style="text-align: center;"></span>

                                <div class="tac  mt20 hide">
                                    <div class="checkbox i-checks">
                                        <label>
                                            <input id="chk" type="checkbox" value="已同意协议" name="protocol">
                                            <i></i>
                                            我已阅读并接受<a href="#" class="linkBlue" id="agreement">《53iq智能云开发者协议》</a>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="tac mt30" style="float: left;width: 100%">
                                <span><button id="go" type="button" class="btn btn-s-lg btn-success">继 续</button></span>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block end_script %}
    <script src="/static/js/product/bootbox.js"></script>
    <script>
        var brandListData = {{ factory_list|safe }};
        function showBrandList(ulID, qVal) {
            $("#" + ulID).show();
            $("#" + ulID).html("");
            if (qVal) {
                for (var i = 0; i < brandListData.length; i++) {
                    var brandName = brandListData[i].brandName;
                    if (brandName.indexOf(qVal) == -1) {
                        continue;
                    }
                    $("#" + ulID).append($("<li onclick='clickQueryDiv(this)' id='" + brandListData[i].brandId + "'>" + brandListData[i].brandName + "</li>"));
                }
            }
            else {
                for (var i = 0; i < brandListData.length; i++) {
                    $("#" + ulID).append($("<li onclick='clickQueryDiv(this)' id='" + brandListData[i].brandId + "'>" + brandListData[i].brandName + "</li>"));
                }
            }
        }
        function clickQueryDiv(liObj) {
            var $liObj = $(liObj);
            var $textObj = $liObj.parent().parent().children(":first");
            $textObj.val($liObj.html());
            $textObj.attr("title", $liObj.html());
            $("#brandNameText").val($liObj.text());
            $("#brand_id").val($liObj.attr("id"));
            $liObj.parent().hide();

        }
        function showHide() {
            var a = $("#product_command").val();
            if (a == '是') {
                $("#my-label-1").hide();
                $("#my-label-2").show();
            }
            else {
                $("#my-label-2").hide();
                $("#my-label-1").show();
            }
        }
        function HideCommand() {
            var a = $("#product_group").val();
            if (a == '1') {
                $('#command-type').css("display", "none");
            }
            else {
                $('#command-type').css("display", "block");
            }
        }
        function selectScheme(item, val) {
            $(".plan").removeClass('cur');
            $(item).addClass('cur');
            $("#product_group").val(val);

        }
        function check_category(obj) {
            var value = $("#product_category option:selected").val();
            if(value == '无'){
                $(".check-sel").css('display','block');
                return false;
            }
            else {
                $(".check-sel").css('display','none')
                return true
            }
        }
        function check_app_name(obj) {
            if($("#productNameText").val() == ""){
                $(".check-appname").css('display','block');
                return false;
            }
            else {
                $(".check-appname").css('display','none');
                return true
            }
        }
        $(document).ready(function () {
            $('#go').on('click', function (e) {
                if (check_app_name() && check_category())
                {
                    $("form[name=productAddForm]").submit();
                }
            });
            $("#product_category").on('change', function () {
                var value = $("#product_category option:selected").val();
                if (value == '无') {
                    html = '<option value="0">请选择分类</option>'
                }
                else if (value == '厨房类') {
                    html = '<option value="1">油烟机</option><option value="2">集成灶</option><option value="6">冰箱</option>' +
                        '<option value="11">烤箱</option><option value="20">蒸箱</option><option value="25">电压力锅</option>' +
                        '<option value="26">电饭煲</option><option value="27">台式小烤箱</option><option value="0">其他</option>'
                }
                else if (value == '卫浴类') {
                    html = '<option value="12">马桶</option><option value="19">饮水机</option>'
                }
                $("#product_category_detail").html(html)
            });

        })
    </script>
{% endblock %}